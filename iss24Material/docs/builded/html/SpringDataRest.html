
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>SpringDataRest &#8212; iss24 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SpringBootWebSocket" href="SpringBootWebSocket.html" />
    <link rel="prev" title="SpringBootIntro" href="SpringBootIntro.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="SpringBootWebSocket.html" title="SpringBootWebSocket"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="SpringBootIntro.html" title="SpringBootIntro"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">iss24 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">SpringDataRest</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="springdatarest">
<h1>SpringDataRest<a class="headerlink" href="#springdatarest" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://spring.io/projects/spring-data-rest">https://spring.io/projects/spring-data-rest</a></p>
<ol class="arabic simple">
<li><p>Progetto SpringDataRest. Esempio di sviluppo di un’applicazione CRUD: <a class="reference internal" href="#springdatarest-requisiti"><span class="std std-ref">SpringDataRest: requisiti</span></a></p></li>
<li><p>Impostazione del server HTTP <a class="reference internal" href="#springdatarest-hicontroller"><span class="std std-ref">SpringDataRest: HIController</span></a>.</p></li>
<li><p>Parte HumanToMachine dell’applicazione:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#springdatarest-accesso-con-browser"><span class="std std-ref">SpringDataRest: accesso con browser</span></a></p></li>
<li><p><a class="reference internal" href="#springdatarest-accesso-con-hal-browser"><span class="std std-ref">SpringDataRest: accesso con HAL browser</span></a></p></li>
<li><p><a class="reference internal" href="#springdatarest-accesso-con-curl"><span class="std std-ref">SpringDataRest: accesso con curl</span></a></p></li>
<li><p><a class="reference internal" href="#springdatarest-accesso-con-java"><span class="std std-ref">SpringDataRest: accesso con Java</span></a></p></li>
<li><p><a class="reference internal" href="#springdatarest-accesso-con-resttemplate"><span class="std std-ref">SpringDataRest: accesso con RestTemplate</span></a></p></li>
</ul>
</li>
<li><p>Parte MachineToMachine dell’applicazione:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#springdatarest-m2mcontroller"><span class="std std-ref">SpringDataRest: M2MController</span></a></p></li>
</ul>
</li>
<li><p>La descrizione (ex Swagger) <a class="reference internal" href="#springdatarest-descrizione-openapi"><span class="std std-ref">SpringDataRest: descrizione OpenAPI</span></a></p></li>
<li><p><a class="reference internal" href="#springdatarest-interfaces"><span class="std std-ref">SpringDataRest:  interfaces</span></a></p></li>
<li><p><a class="reference internal" href="#actuator"><span class="std std-ref">Actuator</span></a></p></li>
<li><p><a class="reference internal" href="#jconsole"><span class="std std-ref">JConsole</span></a></p></li>
</ol>
<section id="springdatarest-requisiti">
<h2>SpringDataRest: requisiti<a class="headerlink" href="#springdatarest-requisiti" title="Permalink to this heading">¶</a></h2>
<p>Costruire una applicazione (un sistema software) che permette la gestione CRUD di informazioni
relative a persone.
L’applicazione deve essere resa disponibile in rete attraverso una API Restful.</p>
<section id="springdatarest-user-story">
<h3>SpringDataRest: user story<a class="headerlink" href="#springdatarest-user-story" title="Permalink to this heading">¶</a></h3>
<p>Come utente del servizio mi aspetto che,  …</p>
</section>
</section>
<section id="springdatarest-analisi">
<h2>SpringDataRest: analisi<a class="headerlink" href="#springdatarest-analisi" title="Permalink to this heading">¶</a></h2>
<p>Dopo interazione con il committente,  le informazioni relative a persone possono essere
formalmente espresse dalla seguente classe Java:</p>
<section id="person">
<h3>Person<a class="headerlink" href="#person" title="Permalink to this heading">¶</a></h3>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Person</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">firstName</span><span class="p">;</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">(){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;person id=&quot;</span><span class="o">+</span><span class="n">id</span><span class="o">+</span><span class="s">&quot; firstName=&quot;</span><span class="o">+</span><span class="n">firstName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; lastName=&quot;</span><span class="o">+</span><span class="n">lastName</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>I metodi get/set delle proprietà sono omessi perchè qui non essenziali.</p>
</section>
<section id="gestore-crud">
<h3>Gestore CRUD<a class="headerlink" href="#gestore-crud" title="Permalink to this heading">¶</a></h3>
<p>Il gestore logico dei dati richiesto dal committente è molto semplice:
realizza un elenco di <a class="reference internal" href="#person"><span class="std std-ref">Person</span></a> e
offre operazioni per aggiungere/eliminare elementi dall’elenco e cercare/ottenere elementi.</p>
<ul class="simple">
<li><p>parte CREATE: <em>addPerson</em></p></li>
<li><p>parte READ: <em>getFirst, getLast, getAllPersons, getPersonWithLastName</em></p></li>
<li><p>parte UPDATE: todo</p></li>
<li><p>parte DELETE: <em>removePerson</em></p></li>
</ul>
<p>Il gestore implicato dai requisiti può essere formalizzato dalla seguente classe Java:</p>
<section id="datahandler">
<h4>DataHandler<a class="headerlink" href="#datahandler" title="Permalink to this heading">¶</a></h4>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DataHandler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Vector</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userDataList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Vector</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addNewPerson</span><span class="p">(){</span>
<span class="w">        </span><span class="n">Person</span><span class="w"> </span><span class="n">userData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="p">();</span>
<span class="w">        </span><span class="n">userData</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">        </span><span class="n">userData</span><span class="p">.</span><span class="na">setFirstName</span><span class="p">(</span><span class="s">&quot;dummy&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">userData</span><span class="p">.</span><span class="na">setLastName</span><span class="p">(</span><span class="s">&quot;dummy&quot;</span><span class="p">);</span>
<span class="w">         </span><span class="n">userDataList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">userData</span><span class="p">);</span>
<span class="w">        </span><span class="n">id</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addPerson</span><span class="p">(</span><span class="n">Person</span><span class="w"> </span><span class="n">userData</span><span class="p">){</span>
<span class="w">        </span><span class="n">userDataList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">userData</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllPersons</span><span class="p">(){</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">userDataList</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="nf">getLast</span><span class="p">(){</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">userDataList</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="n">addNewPerson</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userDataList</span><span class="p">.</span><span class="na">lastElement</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="nf">getFirst</span><span class="p">(){</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">userDataList</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="n">addNewPerson</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userDataList</span><span class="p">.</span><span class="na">firstElement</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getPersonWithLastName</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">){</span>
<span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">pFound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;person not found&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="c1">//Scandisce userDataList cercando la prima persona con lastName</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">pFound</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">removePerson</span><span class="p">(</span><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="p">){</span>
<span class="w">      </span><span class="n">userDataList</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="springdatarest-api-restful">
<h3>SpringDataRest: API Restful<a class="headerlink" href="#springdatarest-api-restful" title="Permalink to this heading">¶</a></h3>
<p>Al momento questo requisito suggerisce l’uso di un framework specializzato come <a class="reference internal" href="SpringBootIntro.html#springbootintro"><span class="std std-ref">SpringBoot</span></a>.</p>
<ul class="simple">
<li><p><span class="blue">HATEOAS</span> sta per <em>Hypermedia as the Engine of Application State</em>.</p></li>
<li><p><span class="blue">HAL</span> (<em>Hypertext Application Language</em>)  fornisce un formato coerente  per il collegamento
ipertestuale tra le risorse.</p></li>
</ul>
</section>
<section id="springdatarest-piano-di-lavoro">
<h3>SpringDataRest: piano di lavoro<a class="headerlink" href="#springdatarest-piano-di-lavoro" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Creazione di un progetto SpringBoot  con
interazioni <em>HumanMachine</em> (<span class="blue">hm</span>) e <em>MachineToMachine</em> (<span class="blue">m2m</span>)</p></li>
<li><p>Testing con RestTemplate ()</p></li>
<li><p>Swagger</p></li>
</ol>
</section>
</section>
<section id="springdatarest-impostazione-del-workspace">
<h2>SpringDataRest: impostazione del workspace<a class="headerlink" href="#springdatarest-impostazione-del-workspace" title="Permalink to this heading">¶</a></h2>
<p>Il codice completo del progetto si trova in <strong>progetto  SpringDataRest</strong>.</p>
<section id="springdatarest-build-gradle-iniziale">
<h3>SpringDataRest: build.gradle iniziale<a class="headerlink" href="#springdatarest-build-gradle-iniziale" title="Permalink to this heading">¶</a></h3>
<p>Il progetto inizia con le seguenti dipendenze nel file <em>build.gradle</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="p">{</span>
 <span class="n">implementation</span> <span class="s1">&#39;org.springframework.boot:spring-boot-starter-data-rest&#39;</span>
 <span class="n">implementation</span> <span class="s1">&#39;org.springframework.boot:spring-boot-starter-web&#39;</span>
 <span class="n">testImplementation</span> <span class="s1">&#39;org.springframework.boot:spring-boot-starter-test&#39;</span>
<span class="o">//</span><span class="n">Lombok</span>
  <span class="n">compileOnly</span> <span class="s1">&#39;org.projectlombok:lombok&#39;</span>
  <span class="n">annotationProcessor</span> <span class="s1">&#39;org.projectlombok:lombok&#39;</span>
<span class="o">//</span><span class="n">For</span> <span class="n">java</span> <span class="n">HTTP</span> <span class="n">caller</span>
        <span class="n">implementation</span> <span class="s1">&#39;com.squareup.okhttp:okhttp:2.7.5&#39;</span>
<span class="o">//</span><span class="n">Human</span><span class="o">-</span><span class="n">machine</span> <span class="n">interface</span>
  <span class="n">implementation</span> <span class="s2">&quot;org.springframework.boot:spring-boot-starter-thymeleaf&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="progetto-springdatarest-business-logic">
<h3>Progetto SpringDataRest - business logic<a class="headerlink" href="#progetto-springdatarest-business-logic" title="Permalink to this heading">¶</a></h3>
<p>Il codice che definisce la business logic della applicazione è organizzato su due classi:</p>
<ul class="simple">
<li><p>La classe <a class="reference internal" href="#person"><span class="std std-ref">Person</span></a> che rappresenta i dati</p></li>
<li><p>La classe <a class="reference internal" href="#datahandler"><span class="std std-ref">DataHandler</span></a> che rappresenta il gestore logico dei dati</p></li>
</ul>
</section>
<section id="personguinaive">
<h3>PersonGuiNaive<a class="headerlink" href="#personguinaive" title="Permalink to this heading">¶</a></h3>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span>
      <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>PersonGuiNaive<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="w"> </span><span class="o">...</span><span class="w">  </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>UserData Gui<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Last Person inserted<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span>  <span class="na">ID</span><span class="o">=</span><span class="s">&quot;LASTPERSON&quot;</span><span class="p">&gt;</span>
  id=<span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${lastperson.id}&quot;</span><span class="p">&gt;</span>Replaceable text<span class="p">&lt;/</span><span class="nt">span</span> <span class="p">&gt;</span>
  firstName=<span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${lastperson.firstName}&quot;</span><span class="p">&gt;</span>Replace text<span class="p">&lt;/</span><span class="nt">span</span> <span class="p">&gt;</span>
  lastName=<span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${lastperson.lastName}&quot;</span><span class="p">&gt;</span>Replace text<span class="p">&lt;/</span><span class="nt">span</span> <span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Insert a new Person<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/Api/createPerson&quot;</span>  <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${personmodel}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;id&quot;</span><span class="p">&gt;</span>ID : <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{id}&quot;</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;firstName&quot;</span><span class="p">&gt;</span>FIRSTNAME : <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{firstName}&quot;</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;lastName&quot;</span><span class="p">&gt;</span>LASTNAME : <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{lastName}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Answer to Api/getAPerson?lastName=... <span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;FOUND&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${personfound}&quot;</span><span class="p">&gt;</span> Replaceable text <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Answer to Api/getAllPersons<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">table</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ALLPERSONS&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;person: ${persons}&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${person.id}&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${person.firstName}&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${person.lastName}&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="springdatarest-hicontroller">
<h3>SpringDataRest: HIController<a class="headerlink" href="#springdatarest-hicontroller" title="Permalink to this heading">¶</a></h3>
<p>Il Controller Spring <em>HIController</em> realizza il comportamento di un controllore Human-machine
che restituisce una pagina HTML elaborata da TheamLeaf.
Il path inizia sempre con <span class="blue">Api</span>.</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/Api&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HIController</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span>
</pre></div>
</div>
<section id="hicontroller-api">
<h4>HIController API<a class="headerlink" href="#hicontroller-api" title="Permalink to this heading">¶</a></h4>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateTheModel</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span>
<span class="w">            </span><span class="n">Person</span><span class="w"> </span><span class="n">lastPerson</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">foundPerson</span><span class="p">){</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;personmodel&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="p">());</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;lastperson&quot;</span><span class="p">,</span><span class="w">  </span><span class="n">lastPerson</span><span class="p">);</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;personfound&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">foundPerson</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@GetMapping</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">){</span>
<span class="w">        </span><span class="n">updateTheModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">getLast</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;todo&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;PersonGuiNaive&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">//Rendered by TheamLeaf</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/getAPerson&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">//getAPerson?lastName=Foscolo</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAPerson</span><span class="p">(</span>
<span class="w">          </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;lastName&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">){</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">getPersonWithLastName</span><span class="p">(</span><span class="n">lastName</span><span class="p">);</span>
<span class="w">        </span><span class="n">updateTheModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">getLast</span><span class="p">(),</span><span class="w"> </span><span class="n">ps</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;PersonGuiNaive&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/getAllPersons&quot;</span><span class="p">)</span>
<span class="w">     </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAllPersons</span><span class="p">(</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="p">){</span>
<span class="w">     </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">getAllPersons</span><span class="p">(</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="n">updateTheModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">getLast</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;todo&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;persons&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lp</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">//Further info in page</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;PersonGuiNaive&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/createPerson&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">post</span><span class="p">(</span>
<span class="w">      </span><span class="nd">@ModelAttribute</span><span class="p">(</span><span class="s">&quot;personmodel&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="n">userData</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">addPerson</span><span class="p">(</span><span class="n">userData</span><span class="p">);</span>
<span class="w">        </span><span class="n">updateTheModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">getLast</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;todo&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;PersonGuiNaive&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="remark">La interazione con HIController riceve come risposta una String (la pagina HTML)</span></p>
</section>
</section>
<section id="springdatarest-esecuzione">
<h3>SpringDataRest - esecuzione<a class="headerlink" href="#springdatarest-esecuzione" title="Permalink to this heading">¶</a></h3>
<p>Eseguiamo l’applicazione con il comando:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gradlew</span> <span class="n">bootrun</span>
</pre></div>
</div>
</section>
<section id="springdatarest-accesso-con-browser">
<h3>SpringDataRest: accesso con browser<a class="headerlink" href="#springdatarest-accesso-con-browser" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<tbody>
<tr class="row-odd"><td><p><span class="blue">http://localhost:8080/</span></p></td>
</tr>
<tr class="row-even"><td><p>Restituisce dati JSON relativi al top level service.</p>
<p>La risposta utilizza il formato HAL per l’output JSON e
indica che il server offre un  collegamento situato a <a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;_links&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;profile&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8080/profile&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<table class="docutils align-default" style="width: 100%">
<tbody>
<tr class="row-odd"><td><p><span class="blue">http://localhost:8080/Api</span></p></td>
</tr>
<tr class="row-even"><td><p>Restituisce la pagina generata da  <a class="reference internal" href="#personguinaive"><span class="std std-ref">PersonGuiNaive</span></a> mediante Thymeleaf.</p>
<a class="reference internal image-reference" href="_images/SpringDataRestGuiInit.png"><img alt="_images/SpringDataRestGuiInit.png" class="align-center" src="_images/SpringDataRestGuiInit.png" style="width: 40%;" /></a>
</td>
</tr>
</tbody>
</table>
</section>
<section id="springdatarest-accesso-con-hal-browser">
<h3>SpringDataRest: accesso con HAL browser<a class="headerlink" href="#springdatarest-accesso-con-hal-browser" title="Permalink to this heading">¶</a></h3>
<p>Aggiungianmo la seguente dipendenza:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="p">{</span>
  <span class="o">...</span>
  <span class="n">implementation</span> <span class="s1">&#39;org.springframework.data:spring-data-rest-hal-explorer&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In tal modo l’accesso al server <span class="blue">http://localhost:8080/</span> induce l’esescusione
di un browser specializzato per HAL. :</p>
<a class="reference internal image-reference" href="_images/SpringDataRestHAL.png"><img alt="_images/SpringDataRestHAL.png" class="align-center" src="_images/SpringDataRestHAL.png" style="width: 60%;" /></a>
<p>Pemendo il pulsante GO! dopo avere inserito in <em>Edit Headers</em>:</p>
<ul>
<li><p><span class="blue">/Api</span>: otteniamo una stringa JSON di risposta (in seguito a una seganalzione di errore) della forma:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;!DOCTYPE html&gt; ... &quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Questo è il segno che il browser si aspetta di ricevere messaggi JSON.</p>
</li>
<li><p><span class="blue">/RestApi/getLastPerson</span>: otteniamo  la stringa JSON di risposta del tipo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
  <span class="s2">&quot;firstName&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
  <span class="s2">&quot;lastName&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Questa è la risposta prodotta da <a class="reference internal" href="#springdatarest-m2mcontroller"><span class="std std-ref">SpringDataRest: M2MController</span></a>  che introdurremo tra poco.</p>
</li>
</ul>
</section>
<section id="springdatarest-accesso-con-curl">
<h3>SpringDataRest: accesso con curl<a class="headerlink" href="#springdatarest-accesso-con-curl" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 90%">
<tbody>
<tr class="row-odd"><td><p>Creare dati (POST)</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;id=1&amp;firstName=Alessando&amp;lastName=Manzoni&quot;</span> <span class="o">-</span><span class="n">H</span>
     <span class="s2">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span>
     <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">Api</span><span class="o">/</span><span class="n">createPerson</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Cercare un dato (GET)</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl http://localhost:8080/Api/getAPerson?lastName=Manzoni
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Cercare tutti dati (GET)</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">Api</span><span class="o">/</span><span class="n">getAllPersons</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="springdatarest-accesso-con-java">
<h3>SpringDataRest: accesso con Java<a class="headerlink" href="#springdatarest-accesso-con-java" title="Permalink to this heading">¶</a></h3>
<p>Nella classe <em>unibo.SpringDataRest.callers.DataHttpCaller</em> del progetto <em>SpringDataRest</em>
eseguiamo chiamate HTTP usando
la libreria <em>com.squareup.okhttp.OkHttpClient</em> (si veda <a class="reference external" href="https://www.baeldung.com/guide-to-okhttp">https://www.baeldung.com/guide-to-okhttp</a>).</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DataHIHttpCaller</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">OkHttpClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OkHttpClient</span><span class="p">();</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">BASE_URL</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://localhost:8080/Api&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">runGet</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">){</span>
<span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span>
<span class="w">         </span><span class="n">doGet</span><span class="p">(</span><span class="n">BASE_URL</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;/getAPerson?lastName=&quot;</span><span class="o">+</span><span class="n">lastName</span><span class="p">);</span>
<span class="w">      </span><span class="c1">//System.out.println(response);   //Visualizza la pagina: prolisso</span>
<span class="w">      </span><span class="c1">//Visualizzimamo l&#39;elemento della pagina che contiene la risposta</span>
<span class="w">      </span><span class="n">PageUtil</span><span class="p">.</span><span class="na">readTheHtmlPage</span><span class="p">(</span><span class="n">response</span><span class="p">,</span><span class="s">&quot;FOUND&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">runGetAll</span><span class="p">(</span><span class="w"> </span><span class="p">){</span>
<span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">doGet</span><span class="p">(</span><span class="n">BASE_URL</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;/getAllPersons&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="c1">//System.out.println(response);   //Visualizza la pagina: prolisso</span>
<span class="w">      </span><span class="c1">//Visualizzimamo l&#39;elemento della pagina che contiene la risposta</span>
<span class="w">      </span><span class="n">PageUtil</span><span class="p">.</span><span class="na">readTheHtmlPage</span><span class="p">(</span><span class="n">response</span><span class="p">,</span><span class="s">&quot;ALLPERSONS&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">runCreate</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">firstName</span><span class="p">,</span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">){</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">personData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id=ID&amp;firstName=FN&amp;lastName=LN&quot;</span>
<span class="w">        </span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="n">id</span><span class="p">).</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;FN&quot;</span><span class="p">,</span><span class="n">firstName</span><span class="p">).</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;LN&quot;</span><span class="p">,</span><span class="n">lastName</span><span class="p">);</span>
<span class="w">    </span><span class="n">RequestBody</span><span class="w"> </span><span class="n">body</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">RequestBody</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">      </span><span class="n">MediaType</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">personData</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">respCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doPost</span><span class="p">(</span><span class="n">BASE_URL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/createPerson&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">respCode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;runCreate ok&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;WARNING: runCreate problem:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">respCode</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">//get, post in Java ...</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="c1">//IPOTESI: applicazione attivata</span>
<span class="w">      </span><span class="n">DataHttpCaller</span><span class="w"> </span><span class="n">appl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DataHttpCaller</span><span class="p">();</span>
<span class="w">        </span><span class="n">appl</span><span class="p">.</span><span class="na">runGetAll</span><span class="p">();</span>
<span class="w">        </span><span class="n">appl</span><span class="p">.</span><span class="na">runGet</span><span class="p">(</span><span class="s">&quot;Foscolo&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">//person not found</span>
<span class="w">        </span><span class="n">appl</span><span class="p">.</span><span class="na">runCreate</span><span class="p">(</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="s">&quot;Alessandro&quot;</span><span class="p">,</span><span class="s">&quot;Foscolo&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">appl</span><span class="p">.</span><span class="na">runGet</span><span class="p">(</span><span class="s">&quot;Foscolo&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="get-post-in-java-con-okhttpclient">
<h4>get, post in Java con OkHttpClient<a class="headerlink" href="#get-post-in-java-con-okhttpclient" title="Permalink to this heading">¶</a></h4>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">doGet</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<span class="w">  </span><span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Request</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
<span class="w">      </span><span class="p">.</span><span class="na">url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">  </span><span class="k">try</span><span class="p">{</span>
<span class="w">    </span><span class="n">Response</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">newCall</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="na">execute</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">body</span><span class="p">().</span><span class="na">string</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">){...}</span>
<span class="p">}</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">urlStr</span><span class="p">,</span><span class="w"> </span><span class="n">RequestBody</span><span class="w"> </span><span class="n">body</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="p">{</span>
<span class="w">        </span><span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Request</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">url</span><span class="p">(</span><span class="n">urlStr</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">        </span><span class="n">Call</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">newCall</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
<span class="w">        </span><span class="n">Response</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">call</span><span class="p">.</span><span class="na">execute</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="p">(</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="na">code</span><span class="p">()</span><span class="w">   </span><span class="p">)</span><span class="w">  </span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="pageutil-readthehtmlpage">
<h4>PageUtil.readTheHtmlPage<a class="headerlink" href="#pageutil-readthehtmlpage" title="Permalink to this heading">¶</a></h4>
<p>Utilizza la classe <em>javax.swing.text.html.HTMLEditorKit</em> per ricavare
dalla String che rappresenta una pagina HTML
le informazioni relative all’elemento HTML con ‘id=elementID’, che poi visualizza
su <em>System.out</em>.</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">readTheHtmlPage</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">htmlString</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">elementID</span><span class="p">){</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">HTMLEditorKit</span><span class="w"> </span><span class="n">htmlEditKit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HTMLEditorKit</span><span class="p">();</span>
<span class="w">         </span><span class="n">HTMLDocument</span><span class="w"> </span><span class="n">htmlDocument</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HTMLDocument</span><span class="p">();</span>
<span class="w">         </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">htmlEditKit</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringReader</span><span class="p">(</span><span class="w"> </span><span class="n">htmlString</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">htmlDocument</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Element</span><span class="w"> </span><span class="n">foundField</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">htmlDocument</span><span class="p">.</span><span class="na">getElement</span><span class="p">(</span><span class="n">elementID</span><span class="p">);</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">start</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">foundField</span><span class="p">.</span><span class="na">getStartOffset</span><span class="p">();</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foundField</span><span class="p">.</span><span class="na">getEndOffset</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">;</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">foundField</span><span class="p">.</span><span class="na">getDocument</span><span class="p">().</span><span class="na">getText</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">length</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">){</span>
<span class="w">         </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="resttemplate">
<h3>RestTemplate<a class="headerlink" href="#resttemplate" title="Permalink to this heading">¶</a></h3>
<p>La classe RestTemplate (<a class="reference external" href="https://www.baeldung.com/rest-template">https://www.baeldung.com/rest-template</a>) costituisce un client sincrono,
progettata per chiamare i servizi REST.
I suoi metodi primari, qui di seguito elencati,
sono strettamente legati ai metodi del protocollo HTTP HEAD , GET , POST , PUT , DELETE e OPTIONS.</p>
<ul class="simple">
<li><p><span class="blue">getForEntity()</span>: executes a GET request and returns an object of ResponseEntity class
that contains both the status code  and the resource as an object.</p></li>
<li><p><span class="blue">getForObject()</span> : similar to getForEntity(), but returns the resource directly.</p></li>
<li><p><span class="blue">exchange()</span>: executes a specified HTTP method, such as GET, POST, PUT, etc, and returns a ResponseEntity
containing both the HTTP status code and the resource as an object.</p></li>
<li><p><span class="blue">execute()</span> : similar to the exchange() method, but takes additional parameters:
RequestCallback and ResultSetExtractor.</p></li>
<li><p><span class="blue">headForHeaders()</span>: executes a HEAD request and returns all HTTP headers for the specified URL.</p></li>
<li><p><span class="blue">optionsForAllow()</span>: executes an OPTIONS request and uses the Allow header to return the HTTP methods
that are allowed under the specified URL.</p></li>
<li><p><span class="blue">delete()</span>: deletes the resources at the given URL using the HTTP DELETE method.</p></li>
<li><p><span class="blue">put()</span>: updates a resource for a given URL using the HTTP PUT method.</p></li>
</ul>
<p>Per interagire con il server, occorre creare un’istanza di RestTemplate, eseguire la richiesta,
interpretare la risposta, mappare la risposta agli oggetti di dominio e anche gestire le eccezioni.</p>
<p>Le informazioni consegnate al cliente possono essere in diversi formati,
come ad esempio JSON, XML, HTML, PHP, text, etc.</p>
<section id="resttemplate-vs-webclient">
<h4>RestTemplate vs. WebClient<a class="headerlink" href="#resttemplate-vs-webclient" title="Permalink to this heading">¶</a></h4>
<p>RestTemplate sarà deprecato nelle versioni future di Spring a favore di
WebClient (<a class="reference external" href="https://www.baeldung.com/spring-5-webclient">https://www.baeldung.com/spring-5-webclient</a>) che fornisce un’API sincrona tradizionale,
ma supporta anche un efficiente approccio reattivo, non bloccante e asincrono,
che funziona tramite il protocollo HTTP/1.1.</p>
</section>
</section>
<section id="springdatarest-accesso-con-resttemplate">
<h3>SpringDataRest: accesso con RestTemplate<a class="headerlink" href="#springdatarest-accesso-con-resttemplate" title="Permalink to this heading">¶</a></h3>
<p>RestTemplate può essere usato anche al posto di OkHttpClient per interagire con
<span class="xref std std-ref">SpringDataRest - HIcontroller</span>. Ad esempio (il codice che segue si trova
in <em>unibo.SpringDataRest.callers.RestTemplateApiCaller</em> del <em>progetto  SpringDataRest</em>)
utilizza le seguenti classi per:</p>
<ul class="simple">
<li><p><em>org.springframework.http.HttpEntity&lt;String&gt;</em>  (si veda: <a class="reference external" href="https://www.demo2s.com/java/spring-httpentity-httpentity-t-body.html">https://www.demo2s.com/java/spring-httpentity-httpentity-t-body.html</a>)</p></li>
<li><p><em>org.springframework.http.ResponseEntity&lt;String&gt;</em> (si veda: <a class="reference external" href="https://www.demo2s.com/java/java-org-springframework-http-responseentity.html">https://www.demo2s.com/java/java-org-springframework-http-responseentity.html</a>)</p></li>
</ul>
</section>
<section id="springdatarest-testing-con-resttemplate">
<h3>SpringDataRest: testing con RestTemplate<a class="headerlink" href="#springdatarest-testing-con-resttemplate" title="Permalink to this heading">¶</a></h3>
<p>Il codice precedente può essere riusato all’interno di un
Impostiamo una test JUnit che</p>
<section id="resttemplateapiutil-before-after">
<h4>RestTemplateApiUtil before/after<a class="headerlink" href="#resttemplateapiutil-before-after" title="Permalink to this heading">¶</a></h4>
<p>Prima dei test lanciamo l’applicazione, che viene chiusa al termine degli stessi.</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HITestWithRestTemplate</span><span class="w"> </span><span class="p">{</span>

<span class="nd">@BeforeAll</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">start</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">SpringDataRestApplication</span><span class="p">.</span><span class="na">main</span><span class="p">(</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{});</span>
<span class="w">    </span><span class="n">rtUtil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RestTemplateApiUtil</span><span class="p">(</span><span class="s">&quot;http://localhost:8080/Api&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">@AfterAll</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">end</span><span class="p">(){</span>
<span class="w">    </span><span class="n">SpringDataRestApplication</span><span class="p">.</span><span class="na">closeAppl</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="basictestwithresttemplate-i-test">
<h4>BasicTestWithRestTemplate: i test<a class="headerlink" href="#basictestwithresttemplate-i-test" title="Permalink to this heading">¶</a></h4>
<p>Riportiamo un test di esempio che effettua i seguenti passi:</p>
<ol class="arabic simple">
<li><p>Verifica che la persona con <em>lastName=”Foscolo”</em> non esiste (la lista dei dati è inizialmente composta
da un persona con <em>lastName=”dummy”</em> )</p></li>
<li><p>Crea la persona <em>Ugo Fosoolo</em></p></li>
<li><p>Verifica che la persona con <em>lastName=”Foscolo”</em> ora esiste</p></li>
<li><p>Elimina la persona <em>Ugo Fosoolo</em> appena creata in modo da lasicare la lista dei dati
nell sua configurazione iniziale.</p></li>
</ol>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">RestTemplateApiUtil</span><span class="w"> </span><span class="n">rtUtil</span><span class="p">;</span>
<span class="nd">@Test</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testGetFoscoloAfterCreate</span><span class="p">(){</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;=== testGetFoscoloAfterCreate&quot;</span><span class="w">  </span><span class="p">);</span>
<span class="w">    </span><span class="n">ckeckPerson</span><span class="p">(</span><span class="s">&quot;Foscolo&quot;</span><span class="p">,</span><span class="s">&quot;person not found&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="c1">//CREATE</span>
<span class="w">    </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">rtUtil</span><span class="p">.</span><span class="na">createPerson</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;Ugo&quot;</span><span class="p">,</span><span class="s">&quot;Foscolo&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">()</span><span class="o">==</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//CHECK</span>
<span class="w">    </span><span class="n">ckeckPerson</span><span class="p">(</span><span class="s">&quot;Foscolo&quot;</span><span class="p">,</span><span class="s">&quot;lastName=Foscolo&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="c1">//DELETE</span>
<span class="w">    </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtUtil</span><span class="p">.</span><span class="na">deletePerson</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;Ugo&quot;</span><span class="p">,</span><span class="s">&quot;Foscolo&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">()</span><span class="o">==</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//CHECK</span>
<span class="w">    </span><span class="n">ckeckPerson</span><span class="p">(</span><span class="s">&quot;Foscolo&quot;</span><span class="p">,</span><span class="s">&quot;person not found&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="ckeckperson">
<h5>ckeckPerson<a class="headerlink" href="#ckeckperson" title="Permalink to this heading">¶</a></h5>
<p>L’operazione che verifica l’esistenza di una persona è così definita:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">ckeckPerson</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">expected</span><span class="p">){</span>
<span class="w">    </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">rtUtil</span><span class="p">.</span><span class="na">getAPerson</span><span class="p">(</span><span class="n">lastName</span><span class="p">);</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PageUtil</span><span class="p">.</span><span class="na">readTheHtmlPage</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;FOUND&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">()</span><span class="o">==</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">);</span>
<span class="w">    </span><span class="n">assertTrue</span><span class="p">(</span><span class="w"> </span><span class="n">answer</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">expected</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Per determinare i valori inclusi da <span class="xref std std-ref">SpringDataRest - HIController</span>  nella pagina di risposta
abbiamo riusato <a class="reference internal" href="#pageutil-readthehtmlpage"><span class="std std-ref">PageUtil.readTheHtmlPage</span></a>.</p>
</section>
</section>
<section id="resttemplateapiutil">
<h4>RestTemplateApiUtil<a class="headerlink" href="#resttemplateapiutil" title="Permalink to this heading">¶</a></h4>
<p>La classe <em>RestTemplateApiUtil</em> usata dalle procedure di testing trasforma una operazione ‘di business’
in una chiamata al <span class="xref std std-ref">SpringDataRest - HIController</span> che usa
<a class="reference internal" href="#springdatarest-accesso-con-resttemplate"><span class="std std-ref">SpringDataRest: accesso con RestTemplate</span></a>.</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RestTemplateApiUtil</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="kd">protected</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">BASE_URL</span><span class="w"> </span><span class="p">;</span>
<span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="nf">RestTemplateApiUtil</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">BASE_URL</span><span class="p">){</span>
<span class="w">       </span><span class="k">this</span><span class="p">.</span><span class="na">BASE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BASE_URL</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getLastPerson</span><span class="p">(</span><span class="w"> </span><span class="p">){</span>
<span class="w">       </span><span class="k">return</span><span class="w">  </span><span class="n">doGet</span><span class="p">(</span><span class="n">BASE_URL</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAPerson</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">){</span>
<span class="w">        </span><span class="k">return</span><span class="w">  </span><span class="n">doGet</span><span class="p">(</span><span class="n">BASE_URL</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;/getAPerson?lastName=&quot;</span><span class="o">+</span><span class="n">lastName</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllPersons</span><span class="p">(</span><span class="w"> </span><span class="p">){</span>
<span class="w">       </span><span class="k">return</span><span class="w">  </span><span class="n">doGet</span><span class="p">(</span><span class="n">BASE_URL</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;/getAllPersons&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createPerson</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">                    </span><span class="n">String</span><span class="w"> </span><span class="n">firstName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">HttpHeaders</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HttpHeaders</span><span class="p">();</span>
<span class="w">      </span><span class="n">headers</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_FORM_URLENCODED</span><span class="p">);</span>
<span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">personData</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id=ID&amp;firstName=FN&amp;lastName=LN&quot;</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="n">id</span><span class="p">)</span>
<span class="w">              </span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;FN&quot;</span><span class="p">,</span><span class="n">firstName</span><span class="p">).</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;LN&quot;</span><span class="p">,</span><span class="n">lastName</span><span class="p">);</span>
<span class="w">      </span><span class="n">HttpEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HttpEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="n">personData</span><span class="p">,</span><span class="n">headers</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">doPost</span><span class="p">(</span><span class="n">BASE_URL</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;/createPerson&quot;</span><span class="p">,</span><span class="n">entity</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">deletePerson</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">                    </span><span class="n">String</span><span class="w"> </span><span class="n">firstName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">HttpHeaders</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HttpHeaders</span><span class="p">();</span>
<span class="w">      </span><span class="n">headers</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="na">APPLICATION_FORM_URLENCODED</span><span class="p">);</span>
<span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">personData</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id=ID&amp;firstName=FN&amp;lastName=LN&quot;</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;ID&quot;</span><span class="p">,</span><span class="n">id</span><span class="p">)</span>
<span class="w">              </span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;FN&quot;</span><span class="p">,</span><span class="n">firstName</span><span class="p">).</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;LN&quot;</span><span class="p">,</span><span class="n">lastName</span><span class="p">);</span>
<span class="w">      </span><span class="n">HttpEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HttpEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="n">personData</span><span class="p">,</span><span class="n">headers</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">doDelete</span><span class="p">(</span><span class="n">BASE_URL</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;/deletePerson&quot;</span><span class="p">,</span><span class="n">entity</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="resttemplateapiutil-basic-ops">
<h4>RestTemplateApiUtil: basic ops<a class="headerlink" href="#resttemplateapiutil-basic-ops" title="Permalink to this heading">¶</a></h4>
<p>Le operazioni che  usano <a class="reference internal" href="#springdatarest-accesso-con-resttemplate"><span class="std std-ref">SpringDataRest: accesso con RestTemplate</span></a>
per realizzare le chiamate REST sono così definite:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">protected</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">doGet</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">RestTemplate</span><span class="w"> </span><span class="n">rt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RestTemplate</span><span class="p">(</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rt</span><span class="p">.</span><span class="na">getForEntity</span><span class="p">(</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">protected</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">urlStr</span><span class="p">,</span><span class="w"> </span><span class="n">HttpEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">RestTemplate</span><span class="w"> </span><span class="n">rt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RestTemplate</span><span class="p">(</span><span class="w"> </span><span class="p">);</span>
<span class="w">     </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rt</span>
<span class="w">            </span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">urlStr</span><span class="p">,</span><span class="w"> </span><span class="n">HttpMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">protected</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">doDelete</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">urlStr</span><span class="p">,</span><span class="w"> </span><span class="n">HttpEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">RestTemplate</span><span class="w"> </span><span class="n">rt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RestTemplate</span><span class="p">(</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rt</span>
<span class="w">            </span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">urlStr</span><span class="p">,</span><span class="w"> </span><span class="n">HttpMethod</span><span class="p">.</span><span class="na">DELETE</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="springdatarest-m2mcontroller">
<h3>SpringDataRest: M2MController<a class="headerlink" href="#springdatarest-m2mcontroller" title="Permalink to this heading">¶</a></h3>
<p>Il Controller Spring <em>M2MController</em> realizza il comportamento di un controllore Machine-to-machine
che restituisce dati in formato JSON.
Il path inizia sempre con <span class="blue">/RestApi</span>.</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/RestApi&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="nd">@CrossOrigin</span><span class="p">(</span><span class="n">origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;*&quot;</span><span class="p">)</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">M2MController</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="p">...</span>
</pre></div>
</div>
<section id="m2mcontroller-api">
<h4>M2MController API<a class="headerlink" href="#m2mcontroller-api" title="Permalink to this heading">¶</a></h4>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/getLastPerson&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="nf">getLastPerson</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">getLast</span><span class="p">();</span>
<span class="w">    </span><span class="c1">//Restituice un oggetto Java di class Person</span>
<span class="w">    </span><span class="c1">//poichè produce &quot;application/json&quot; i dati sono convertiti in Json</span>
<span class="w">    </span><span class="c1">//Ad esempio:{&quot;id&quot;:2,&quot;firstName&quot;:&quot;Alessando&quot;,&quot;lastName&quot;:&quot;Manzoni&quot;}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/getAllPersons&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getAllPersons</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">getAllPersons</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/createPersonWithModel&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createPersonWithModel</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">HttpHeaders</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HttpHeaders</span><span class="p">();</span>
<span class="w">      </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">addPerson</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">headers</span><span class="p">,</span><span class="w"> </span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">CREATED</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/createPerson&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createPersonWithParams</span><span class="p">(</span>
<span class="w">                </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">                </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;firstName&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">firstName</span><span class="p">,</span>
<span class="w">                </span><span class="nd">@RequestParam</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;lastName&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lastName</span><span class="p">,</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="p">();</span>
<span class="w">      </span><span class="n">p</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
<span class="w">      </span><span class="n">p</span><span class="p">.</span><span class="na">setFirstName</span><span class="p">(</span><span class="n">firstName</span><span class="p">);</span>
<span class="w">      </span><span class="n">p</span><span class="p">.</span><span class="na">setLastName</span><span class="p">(</span><span class="n">lastName</span><span class="p">);</span>
<span class="w">      </span><span class="n">DataHandler</span><span class="p">.</span><span class="na">addPerson</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p><span class="remark">La interazione con RestApiController riceve come risposta una String Json</span></p>
</section>
</section>
<section id="dataonly-rest-testing-con-resttemplate">
<h3>DataOnly REST: testing con RestTemplate<a class="headerlink" href="#dataonly-rest-testing-con-resttemplate" title="Permalink to this heading">¶</a></h3>
<p>Il test è simile a <a class="reference internal" href="#springdatarest-testing-con-resttemplate"><span class="std std-ref">SpringDataRest: testing con RestTemplate</span></a>, con òe seguenti modifiche:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">M2MTestWithRestTemplate</span> <span class="p">{</span>
<span class="n">private</span> <span class="n">static</span> <span class="n">RestTemplateApiUtil</span> <span class="n">rtUtil</span><span class="p">;</span>

<span class="nd">@BeforeAll</span>
<span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">start</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
    <span class="n">SpringDataRestApplication</span><span class="o">.</span><span class="n">main</span><span class="p">(</span> <span class="n">new</span> <span class="n">String</span><span class="p">[]{});</span>
    <span class="n">rtUtil</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RestTemplateApiUtil</span><span class="p">(</span><span class="s2">&quot;http://localhost:8080/RestApi&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">private</span> <span class="n">void</span> <span class="n">ckeckPersonRestApi</span><span class="p">(</span><span class="n">String</span> <span class="n">lastName</span><span class="p">,</span><span class="n">boolean</span> <span class="n">expected</span><span class="p">){</span>
  <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span>  <span class="n">rtUtil</span><span class="o">.</span><span class="n">getAPerson</span><span class="p">(</span><span class="n">lastName</span><span class="p">);</span>
  <span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">getStatusCode</span><span class="p">()</span><span class="o">==</span><span class="n">HttpStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">expected</span> <span class="p">)</span> <span class="n">assertTrue</span><span class="p">(</span> <span class="n">response</span><span class="o">.</span><span class="n">getBody</span><span class="p">()</span> <span class="o">!=</span> <span class="n">null</span> <span class="p">);</span>
  <span class="k">else</span> <span class="n">assertTrue</span><span class="p">(</span> <span class="n">response</span><span class="o">.</span><span class="n">getBody</span><span class="p">()</span> <span class="o">==</span> <span class="n">null</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Nel caso la persona esista, il valore di <em>response.getBody()</em> è una stringa JSon che rappresenta i
dati della persona trovata; ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;firstName&quot;</span><span class="p">:</span><span class="s2">&quot;Ugo&quot;</span><span class="p">,</span><span class="s2">&quot;lastName&quot;</span><span class="p">:</span><span class="s2">&quot;Foscolo&quot;</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="springdatarest-descrizione-openapi">
<h2>SpringDataRest: descrizione OpenAPI<a class="headerlink" href="#springdatarest-descrizione-openapi" title="Permalink to this heading">¶</a></h2>
<p>OpenAPI è una specifica, cioè una descrizione astratta che non è legata a un’implementazione
particolare. Fino alla versione 2.0, questa specifica era chiamata Swagger ed è stata rinominata
in seguito specifica OpenAPI. Tuttavia, i tool forniti dalla società di sviluppo originale,
SmartBear, continuano a esistere con il nome di Swagger.</p>
<p>Aggiungiamo in <span class="xref std std-ref">SpringDataRest - build.gradle iniziale</span> la dipendenza alla libreria springdoc-openapi
che sostituisce la libreria SpringFox, non più mantenuta. Questa libreria
esamina a runtime  l’applicazione, per inferirne la API semantics basata sulla configurazione Spring,
sulla struttura delle classi e sulle annotwzioni.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">Aggiungere</span> <span class="ow">in</span> <span class="n">build</span><span class="o">.</span><span class="n">gradle</span>
      <span class="n">implementation</span> <span class="s1">&#39;org.springdoc:springdoc-openapi-ui:1.6.11&#39;</span>

<span class="o">//</span><span class="n">Aggiungere</span> <span class="ow">in</span> <span class="n">application</span><span class="o">.</span><span class="n">properties</span>
      <span class="n">spring</span><span class="o">.</span><span class="n">mvc</span><span class="o">.</span><span class="n">pathmatch</span><span class="o">.</span><span class="n">matching</span><span class="o">-</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">ANT_PATH_MATCHER</span>


<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">editor</span><span class="o">.</span><span class="n">swagger</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="c1">#</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">swagger</span><span class="o">-</span><span class="n">ui</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>Fornisce la gui che segue:</p>
<a class="reference internal image-reference" href="_images/SpringDataRestSwaggerUi.png"><img alt="_images/SpringDataRestSwaggerUi.png" class="align-center" src="_images/SpringDataRestSwaggerUi.png" style="width: 80%;" /></a>
<p>L’uso di questa GUI permette l’esecuzione delle operazioni disponibili, fornendo anche le chianate in curl.
Ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="s1">&#39;GET&#39;</span> \
  <span class="s1">&#39;http://localhost:8080/RestApi/getAllPersons&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;accept: application/json&#39;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">swagger</span><span class="o">-</span><span class="n">ui</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>Fornisce le informazioni sulle operazioni in Json.</p>
</section>
<section id="springdatarest-interfaces">
<h2>SpringDataRest:  interfaces<a class="headerlink" href="#springdatarest-interfaces" title="Permalink to this heading">¶</a></h2>
<p>A partire da <em>Spring Framewrk 5.0</em> è possibile descrivere API RESTful mediante interfacce Java.</p>
<p>Supponiamo ad esempio dei definire:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">interface</span> <span class="n">PersonService</span> <span class="p">{</span>
  <span class="nd">@GetMapping</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;/person/</span><span class="si">{personId}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">produces</span> <span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">)</span>
  <span class="n">Person</span> <span class="n">getPerson</span><span class="p">(</span><span class="nd">@PathVariable</span> <span class="nb">int</span> <span class="n">personId</span><span class="p">,</span>
                   <span class="nd">@RequestParam</span><span class="p">(</span><span class="n">required</span> <span class="o">=</span> <span class="n">false</span><span class="p">)</span><span class="n">String</span> <span class="n">arg</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Questa specifica include le seguenti informazioni:</p>
<blockquote>
<div><ul>
<li><p><span class="blue">&#64;GetMapping</span>: specifica che il metodo <em>getPerson</em> è mappato a una richiesta
HTTP GET con URL-path= <span class="brown">/person/{personId}?arg=…</span> e che il formato della risposta è JSON.</p></li>
<li><p><span class="blue">&#64;PathVariable</span>: specifica che il path variabile name <span class="brown">{personId}</span> della GET
è mappato all’argomento <em>personId</em> del metodo.</p>
<p>Ad esempio, una HTTP <em>GET /person</em><span class="brown">/3</span> si traduce in una chiamata a <em>getPerson(3,””)</em>.</p>
</li>
<li><p><span class="blue">&#64;RequestParam</span>: specifica che i parametri di query (opzionali) devono essere
mappati nell’argomento <em>arg</em> del metodo.</p>
<p>Ad esempio, una HTTP <em>GET /person/3</em><span class="brown">?arg=abc</span> si traduce in una chiamata a <em>getPerson(3,”abc”)</em>.</p>
</li>
<li><p>Il metodo <em>getPerson</em> restituisce un POJO di tipo Person, che costituisce il
<span class="blue">DTO</span> (<em>Data Transfer Object</em>) usato per trasferire i dati di risposta al caller.</p></li>
</ul>
</div></blockquote>
<section id="springdatarest-interface-implementation">
<h3>SpringDataRest: interface implementation<a class="headerlink" href="#springdatarest-interface-implementation" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@RestController</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">M2MController</span> <span class="n">implements</span> <span class="n">PersonService</span> <span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="n">public</span> <span class="n">Person</span> <span class="n">getPerson</span><span class="p">(</span><span class="nb">int</span> <span class="n">personId</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Person</span> <span class="n">p</span><span class="o">=</span><span class="n">DataHandler</span><span class="o">.</span><span class="n">getPersonWithId</span><span class="p">(</span> <span class="n">Long</span><span class="o">.</span><span class="n">valueOf</span><span class="p">(</span><span class="n">personId</span><span class="p">)</span> <span class="p">);</span>
      <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>Indicazione</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl http://localhost:8080/RestApi/person?personId=1
curl http://localhost:8080/RestApi/person/1
curl http://localhost:8080/RestApi/getLastPerson
</pre></div>
</div>
</section>
</section>
<section id="actuator">
<h2>Actuator<a class="headerlink" href="#actuator" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">implementation</span>
  <span class="s1">&#39;org.springframework.boot:spring-boot-starter-actuator:2.7.4&#39;</span>
</pre></div>
</div>
<p>Actuator viene attualmente fornito con la maggior parte degli endpoint disabilitati.
Per abilitarli:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">management</span><span class="o">.</span><span class="n">endpoints</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">exposure</span><span class="o">.</span><span class="n">include</span><span class="o">=*</span>
</pre></div>
</div>
<p>Actuator espone i suoi endpoints come <span class="blue">MBean</span> che possono essere visualizzati e gestiti con strumenti
(tra cui la <a class="reference internal" href="#jconsole"><span class="std std-ref">JConsole</span></a>) conformi alla specifica JMX (Java Management Extensions).</p>
<p>Apriamo un browsser ed esguiamo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">explorer</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span><span class="c1">#uri=/actuator</span>
</pre></div>
</div>
<p>In questo modo attiviamo <a class="reference internal" href="#springdatarest-accesso-con-hal-browser"><span class="std std-ref">SpringDataRest: accesso con HAL browser</span></a> con header=/actuator, il che
produce la pagina delle Links section in una forma più user-friendly:</p>
<a class="reference internal image-reference" href="_images/SpringDataRestActuatorHAL.png"><img alt="_images/SpringDataRestActuatorHAL.png" class="align-center" src="_images/SpringDataRestActuatorHAL.png" style="width: 80%;" /></a>
<section id="jconsole">
<h3>JConsole<a class="headerlink" href="#jconsole" title="Permalink to this heading">¶</a></h3>
<p>In una finestra di comando del sistema operativo, inviamo il comando <span class="blue">JConsole</span>.</p>
<p>L’interfaccia utente grafica di JConsole è uno strumento di monitoraggio
conforme alla specifica JMX (<em>Java Management Extensions</em>).</p>
<p>L’eseguibile JConsole si trova in <em>JDK_HOME/bin</em> , dove JDK_HOME è la directory in cui è installato
il Java Development Kit (JDK). Nel caso il comando non venga trovato, aggiornare il path; ad esempio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">PATH</span><span class="o">=</span><span class="n">C</span><span class="p">:</span>\<span class="n">Program</span> <span class="n">Files</span>\<span class="n">Java</span>\<span class="n">jdk</span><span class="o">-</span><span class="mf">11.0.9</span>\<span class="nb">bin</span><span class="p">;</span><span class="o">%</span><span class="n">PATH</span><span class="o">%</span>
</pre></div>
</div>
<p>L’avvio di JConsole senza alcun argomento rileverà automaticamente tutte le applicazioni Java locali
e visualizzerà una finestra di dialogo che consente di selezionare l’applicazione che si desidera monitorare.</p>
<a class="reference internal image-reference" href="_images/SpringDataRestJConsole.png"><img alt="_images/SpringDataRestJConsole.png" class="align-center" src="_images/SpringDataRestJConsole.png" style="width: 80%;" /></a>
<p>JMX fornisce strumenti per la gestione e il monitoraggio di applicazioni, oggetti di sistema,
dispositivi (come le stampanti) e reti orientate ai servizi.
Tali risorse sono rappresentate da oggetti chiamati Managed Bean (o <span class="blue">MBean</span>).
Si veda: <a class="reference external" href="https://www.oracle.com/technical-resources/articles/java/jconsole.html">https://www.oracle.com/technical-resources/articles/java/jconsole.html</a></p>
<p>JConsole utilizza l’ampia strumentazione della Java Virtual Machine (JVM) per fornire informazioni sulle prestazioni
e sul consumo di risorse delle applicazioni in esecuzione sulla piattaforma Java.</p>
<p>L’utilizzo di JConsole per monitorare un’applicazione locale è utile per lo sviluppo e per la creazione di prototipi,
ma non è consigliato per gli ambienti di produzione, poiché JConsole stessa consuma notevoli risorse di sistema.
Si consiglia il monitoraggio remoto per isolare l’applicazione JConsole dalla piattaforma monitorata.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">SpringDataRest</a><ul>
<li><a class="reference internal" href="#springdatarest-requisiti">SpringDataRest: requisiti</a><ul>
<li><a class="reference internal" href="#springdatarest-user-story">SpringDataRest: user story</a></li>
</ul>
</li>
<li><a class="reference internal" href="#springdatarest-analisi">SpringDataRest: analisi</a><ul>
<li><a class="reference internal" href="#person">Person</a></li>
<li><a class="reference internal" href="#gestore-crud">Gestore CRUD</a><ul>
<li><a class="reference internal" href="#datahandler">DataHandler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#springdatarest-api-restful">SpringDataRest: API Restful</a></li>
<li><a class="reference internal" href="#springdatarest-piano-di-lavoro">SpringDataRest: piano di lavoro</a></li>
</ul>
</li>
<li><a class="reference internal" href="#springdatarest-impostazione-del-workspace">SpringDataRest: impostazione del workspace</a><ul>
<li><a class="reference internal" href="#springdatarest-build-gradle-iniziale">SpringDataRest: build.gradle iniziale</a></li>
<li><a class="reference internal" href="#progetto-springdatarest-business-logic">Progetto SpringDataRest - business logic</a></li>
<li><a class="reference internal" href="#personguinaive">PersonGuiNaive</a></li>
<li><a class="reference internal" href="#springdatarest-hicontroller">SpringDataRest: HIController</a><ul>
<li><a class="reference internal" href="#hicontroller-api">HIController API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#springdatarest-esecuzione">SpringDataRest - esecuzione</a></li>
<li><a class="reference internal" href="#springdatarest-accesso-con-browser">SpringDataRest: accesso con browser</a></li>
<li><a class="reference internal" href="#springdatarest-accesso-con-hal-browser">SpringDataRest: accesso con HAL browser</a></li>
<li><a class="reference internal" href="#springdatarest-accesso-con-curl">SpringDataRest: accesso con curl</a></li>
<li><a class="reference internal" href="#springdatarest-accesso-con-java">SpringDataRest: accesso con Java</a><ul>
<li><a class="reference internal" href="#get-post-in-java-con-okhttpclient">get, post in Java con OkHttpClient</a></li>
<li><a class="reference internal" href="#pageutil-readthehtmlpage">PageUtil.readTheHtmlPage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resttemplate">RestTemplate</a><ul>
<li><a class="reference internal" href="#resttemplate-vs-webclient">RestTemplate vs. WebClient</a></li>
</ul>
</li>
<li><a class="reference internal" href="#springdatarest-accesso-con-resttemplate">SpringDataRest: accesso con RestTemplate</a></li>
<li><a class="reference internal" href="#springdatarest-testing-con-resttemplate">SpringDataRest: testing con RestTemplate</a><ul>
<li><a class="reference internal" href="#resttemplateapiutil-before-after">RestTemplateApiUtil before/after</a></li>
<li><a class="reference internal" href="#basictestwithresttemplate-i-test">BasicTestWithRestTemplate: i test</a><ul>
<li><a class="reference internal" href="#ckeckperson">ckeckPerson</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resttemplateapiutil">RestTemplateApiUtil</a></li>
<li><a class="reference internal" href="#resttemplateapiutil-basic-ops">RestTemplateApiUtil: basic ops</a></li>
</ul>
</li>
<li><a class="reference internal" href="#springdatarest-m2mcontroller">SpringDataRest: M2MController</a><ul>
<li><a class="reference internal" href="#m2mcontroller-api">M2MController API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dataonly-rest-testing-con-resttemplate">DataOnly REST: testing con RestTemplate</a></li>
</ul>
</li>
<li><a class="reference internal" href="#springdatarest-descrizione-openapi">SpringDataRest: descrizione OpenAPI</a></li>
<li><a class="reference internal" href="#springdatarest-interfaces">SpringDataRest:  interfaces</a><ul>
<li><a class="reference internal" href="#springdatarest-interface-implementation">SpringDataRest: interface implementation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actuator">Actuator</a><ul>
<li><a class="reference internal" href="#jconsole">JConsole</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="SpringBootIntro.html"
                          title="previous chapter">SpringBootIntro</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="SpringBootWebSocket.html"
                          title="next chapter">SpringBootWebSocket</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/SpringDataRest.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="SpringBootWebSocket.html" title="SpringBootWebSocket"
             >next</a> |</li>
        <li class="right" >
          <a href="SpringBootIntro.html" title="SpringBootIntro"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">iss24 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">SpringDataRest</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2024, Antonio Natali.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>