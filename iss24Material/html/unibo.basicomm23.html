
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>unibo.basicomm23 &#8212; iss23 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <script src="_static/sidebar.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Appl1-HTTPSprint3" href="Appl1-HTTPSprint3.html" />
    <link rel="prev" title="Interaction" href="Interaction.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Appl1-HTTPSprint3.html" title="Appl1-HTTPSprint3"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Interaction.html" title="Interaction"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">iss23 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">unibo.basicomm23</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="unibo-basicomm23">
<h1>unibo.basicomm23<a class="headerlink" href="#unibo-basicomm23" title="Permalink to this headline">¶</a></h1>
<p>Il progetto intende  realizzare il concetto di <a class="reference internal" href="Interaction.html#interconnessione"><span class="std std-ref">Interconnessione</span></a>,
fornendo supporti di tipo generale per le comunicazioni via rete un insieme di
<a class="reference internal" href="#unibo-basicomm23-msg-protocoltype"><span class="std std-ref">protocolli</span></a>.</p>
<p><span class="slide">Le interfacce</span></p>
<section id="unibo-basicomm23-interfaces">
<h2>unibo.basicomm23.interfaces<a class="headerlink" href="#unibo-basicomm23-interfaces" title="Permalink to this headline">¶</a></h2>
<p>Il package <code class="docutils literal notranslate"><span class="pre">unibo.basicomm23.interfaces</span></code> definisce un insieme di interfacce che stabiscono i contratti
di riferimento per le interazioni a messaggi.</p>
<p><span class="slide1">Interfaccia Interaction</span></p>
<section id="unibo-basicomm23-interfaces-interaction">
<h3>unibo.basicomm23.interfaces.Interaction<a class="headerlink" href="#unibo-basicomm23-interfaces-interaction" title="Permalink to this headline">¶</a></h3>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">interface</span> <span class="nc">Interaction</span>  <span class="p">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">forward</span><span class="p">(</span> <span class="n">String</span> <span class="n">msg</span> <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">request</span><span class="p">(</span>  <span class="n">String</span> <span class="n">msg</span> <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reply</span><span class="p">(</span>  <span class="n">String</span> <span class="n">msg</span> <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">receiveMsg</span><span class="p">(</span>  <span class="p">)</span>  <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">forward</span><span class="p">(</span>  <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
  <span class="kd">public</span> <span class="n">IApplMessage</span> <span class="nf">request</span><span class="p">(</span>  <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reply</span><span class="p">(</span>  <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
  <span class="kd">public</span> <span class="n">IApplMessage</span> <span class="nf">receive</span><span class="p">(</span>  <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">;</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="p">(</span> <span class="p">)</span>  <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="p">(</span> <span class="p">)</span>  <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Un oggetto che implementa l’interfaccia <em>Interaction</em> realizza in modo concreto
il concetto astratto di <a class="reference internal" href="Interaction.html#interconnessione"><span class="std std-ref">Interconnessione</span></a> usando uno specifico <a class="reference internal" href="#unibo-basicomm23-msg-protocoltype"><span class="std std-ref">protocollo</span></a>.</p>
<p>Si veda <a class="reference internal" href="#unibo-basicomm23-utils-connectionfactory"><span class="std std-ref">ConnectionFactory</span></a>.</p>
<p><span class="slide1">Interfacce per messaggi applicativi</span></p>
</section>
<section id="unibo-interaction-interfaces-iapplmessage">
<h3>unibo.interaction.interfaces.IApplMessage<a class="headerlink" href="#unibo-interaction-interfaces-iapplmessage" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span> <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IApplMessage</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">msgId</span><span class="p">();</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">msgType</span><span class="p">();</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">msgSender</span><span class="p">();</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">msgReceiver</span><span class="p">();</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">msgContent</span><span class="p">();</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">msgNum</span><span class="p">();</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDispatch</span><span class="p">();</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isRequest</span><span class="p">();</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isReply</span><span class="p">();</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEvent</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Un oggetto che implementa l’interfaccia <em>IApplMessage</em>  rappresenta  un messaggio che segue
uno <span class="blue">standard interno</span> sulla struttura delle informazioni  scambiate via rete.</p>
<p>Si veda <a class="reference internal" href="#unibo-interaction-msg-applmessage"><span class="std std-ref">ApplMessage</span></a>.</p>
</section>
<section id="unibo-interaction-interfaces-iapplmsghandler">
<h3>unibo.interaction.interfaces.IApplMsgHandler<a class="headerlink" href="#unibo-interaction-interfaces-iapplmsghandler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IApplMsgHandler</span>  <span class="p">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="p">();</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">elaborate</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">message</span><span class="p">,</span> <span class="n">Interaction</span>  <span class="n">conn</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Un oggetto che implementa l’interfaccia <em>IApplMsgHandler</em> deve essere definito dall’application designer per
specificare, data una <a class="reference internal" href="Interaction.html#interaction"><span class="std std-ref">Interaction</span></a>  <code class="docutils literal notranslate"><span class="pre">conn</span></code>, come gestire un messaggio ricevuto (metodo <code class="docutils literal notranslate"><span class="pre">elaborate</span></code>)
e come inviare repliche o risposte al chiamante su <code class="docutils literal notranslate"><span class="pre">conn</span></code>.</p>
<p>Oggetti di questo tipo sono usati dai server forniti da <span class="xref std std-ref">ServerFactory</span>.</p>
<p><span class="slide">Protocolli</span></p>
</section>
</section>
<section id="unibo-basicomm23-msg-protocoltype">
<h2>unibo.basicomm23.msg.ProtocolType<a class="headerlink" href="#unibo-basicomm23-msg-protocoltype" title="Permalink to this headline">¶</a></h2>
<p>Per ogni protocollo viene definito un package che ne contiene i supporti low-level.</p>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/basicComm23.png"><img alt="_images/basicComm23.png" src="_images/basicComm23.png" style="width: 100%;" /></a>
</td>
<td><div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">ProtocolType</span> <span class="p">{</span>
    <span class="n">http</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">tcp</span><span class="p">,</span> <span class="n">udp</span><span class="p">,</span> <span class="n">coap</span><span class="p">,</span> <span class="n">mqtt</span><span class="p">,</span> <span class="n">bluetooth</span><span class="p">,</span> <span class="n">serial</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Come implicito nel modello delle <a class="reference internal" href="Principi.html#dependency-inversion"><span class="std std-ref">inversioni di dipendenza</span></a>,
le istanziazioni di variabili richiedono l’implementazione di un <span class="remark">pattern creazionale</span> come un <em>factory method</em>
o il <em>pattern factory</em>, o l’uso di un framework di <em>dependency-injection</em>.</p>
<p>A tal fine, il progetto fornisce una <em>Factory</em>.</p>
<p><span class="slide1">ConnectionFactory</span></p>
<section id="unibo-basicomm23-utils-connectionfactory">
<h3>unibo.basicomm23.utils.ConnectionFactory<a class="headerlink" href="#unibo-basicomm23-utils-connectionfactory" title="Permalink to this headline">¶</a></h3>
<p>La classe <code class="docutils literal notranslate"><span class="pre">ConnectionFactory</span></code>  definisce il metodo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">static</span> <span class="n">Interaction</span> <span class="n">createClientSupport23</span><span class="p">(</span>
        <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">String</span> <span class="n">hostAddr</span><span class="p">,</span> <span class="n">String</span> <span class="n">entry</span> <span class="p">)</span>
</pre></div>
</div>
<p>che restituisce un supporto che permette di utilizzare il protocollo <code class="docutils literal notranslate"><span class="pre">protocol</span></code> per inviare informazioni
al nodo di indirizzo <code class="docutils literal notranslate"><span class="pre">hostAddr</span></code>; la stringa relativa al parametro <span class="blue">entry</span> denota valori che dipendono
dal protocollo: di solito è un numero di porta, ma potrebbe essere anche un <em>Uniform Resource Identifier</em> (URI)
o altro ancora.</p>
<p>L’oggetto di supporto alle comunicazioni restituito dalla factory implementa l’interfaccia
<a class="reference internal" href="#unibo-basicomm23-interfaces-interaction"><span class="std std-ref">Interaction</span></a>,
nascondendo al livello applicativo i dettagli relativi al protocollo.
Al momento sono disponibili (si veda <a class="reference internal" href="#connessioni"><span class="std std-ref">Connessioni</span></a>):</p>
<ul class="simple">
<li><p><a class="reference internal" href="#unibo-basicomm23-http-httpconnection"><span class="std std-ref">HttpConnection</span></a></p></li>
<li><p><a class="reference internal" href="#unibo-basicomm23-ws-wsconnection"><span class="std std-ref">WsConnection</span></a></p></li>
<li><p>TcpConnection</p></li>
<li><p>UdpConnection</p></li>
<li><p><a class="reference internal" href="#unibo-basicomm23-coap-coapconnection"><span class="std std-ref">CoapConnection</span></a></p></li>
<li><p>MqttConnection (todo)</p></li>
<li><p>SerialConnection (todo)</p></li>
<li><p>BluetoothConnection (todo)</p></li>
</ul>
<p>Queste classi specializzano la classe astratta  <a class="reference internal" href="#id5"><span class="std std-ref">unibo.basicomm23.utils.Connection</span></a>
che gestisce messaggi di tipo <a class="reference internal" href="#unibo-interaction-interfaces-iapplmessage"><span class="std std-ref">IApplMessage</span></a>
realizzando i metodi che trattano messaggi di tipo <code class="docutils literal notranslate"><span class="pre">String</span></code>.</p>
</section>
<section id="unibo-basicomm23-utils-connection">
<h3>unibo.basicomm23.utils.Connection<a class="headerlink" href="#unibo-basicomm23-utils-connection" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">abstract</span> <span class="k">class</span> <span class="nc">Connection</span> <span class="n">implements</span> <span class="n">Interaction</span> <span class="p">{</span>
<span class="n">public</span> <span class="n">static</span> <span class="n">boolean</span> <span class="n">trace</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>

    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">forward</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
        <span class="n">forward</span><span class="p">(</span> <span class="n">msg</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">IApplMessage</span> <span class="n">request</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">toString</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">new</span> <span class="n">ApplMessage</span><span class="p">(</span><span class="n">answer</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">IApplMessage</span> <span class="n">receive</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">{</span>
        <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">receiveMsg</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">new</span> <span class="n">ApplMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">reply</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
        <span class="n">reply</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">toString</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">abstract</span> <span class="n">void</span> <span class="n">forward</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">abstract</span> <span class="n">String</span> <span class="n">request</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">abstract</span> <span class="n">void</span> <span class="n">reply</span><span class="p">(</span><span class="n">String</span> <span class="n">reqid</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">abstract</span> <span class="n">String</span> <span class="n">receiveMsg</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">abstract</span> <span class="n">void</span> <span class="n">close</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="connection-trace">
<h4>Connection.trace<a class="headerlink" href="#connection-trace" title="Permalink to this headline">¶</a></h4>
<p>Se la variabile <span class="blue">boolean trace</span> è posta <code class="docutils literal notranslate"><span class="pre">true</span></code>, i metodi visualizzano informazioni
utili a meglio comprendere il funzionamento run-time del sistema.</p>
<p><span class="slide">Abilitatori</span></p>
<p>I componenti di un sistema distribuito devono, di norma, essere capaci di</p>
<ol class="arabic simple">
<li><p><em>ricevere messaggi</em>. Normalmente questo obiettivo viene raggiunto introducendo un <span class="blue">server</span>.</p></li>
<li><p><em>inviare messaggi</em>. Normalmente questo obiettivo viene raggiunto
facendo operare il componente come un <span class="blue">client</span> di un  server .</p></li>
</ol>
<p>Il progetto <a class="reference internal" href="#unibo-basicomm23"><span class="std std-ref">unibo.basicomm23</span></a> fornisce supporti per entrambe queste esigenze, attraverso  classi che forniscono
una sorta di ‘enti abilitatori’ alle comunicazioni.</p>
</section>
</section>
</section>
<section id="abilitatori-di-comunicazione">
<h2>Abilitatori di comunicazione<a class="headerlink" href="#abilitatori-di-comunicazione" title="Permalink to this headline">¶</a></h2>
<p>Parliamo di classi che abilitano alle comunicazioni per enfatizzare il fatto che queste classi
<span class="remark">non includono logica applicativa</span>.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#serverfactory"><span class="std std-ref">ServerFactory</span></a>: costruisce server legati a speoifici protocolli.</p></li>
<li><p><a class="reference internal" href="#actornaivecaller"><span class="std std-ref">ActorNaiveCaller</span></a>: fornisce supporto per inviare messaggi a un server.</p></li>
</ul>
<p><span class="slide1">Abilitatori per la ricezione</span></p>
<section id="serverfactory">
<h3>ServerFactory<a class="headerlink" href="#serverfactory" title="Permalink to this headline">¶</a></h3>
<p>Costruisce server  che danno la capacità di ricevere messaggi usando uno dei protocolli definiti
in <a class="reference internal" href="#unibo-basicomm23-msg-protocoltype"><span class="std std-ref">ProtocolType</span></a>.</p>
<section id="unibo-basicomm23-enablers-severfactory">
<h4>unibo.basicomm23.enablers.SeverFactory<a class="headerlink" href="#unibo-basicomm23-enablers-severfactory" title="Permalink to this headline">¶</a></h4>
<p>Realizza un server che riceve messaggi, delegandone la gestione a un oggetto che
implementa <a class="reference internal" href="#unibo-interaction-interfaces-iapplmsghandler"><span class="std std-ref">IApplMsgHandler</span></a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SeverFactory</span>   <span class="p">{</span>

  <span class="c1">//Factory Method</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">IServer</span> <span class="nf">create</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">,</span>
             <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">IApplMsgHandler</span> <span class="n">handler</span><span class="p">){</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">ServerFactory</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>   <span class="n">port</span><span class="p">,</span>   <span class="n">protocol</span><span class="p">,</span> <span class="n">handler</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="nf">SeverFactory</span><span class="p">(</span>
      <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">IApplMsgHandler</span> <span class="n">handler</span> <span class="p">){</span>
        <span class="p">...</span>
        <span class="n">setServerSupport</span><span class="p">(</span> <span class="n">port</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">handler</span>  <span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">setServerSupport</span><span class="p">(</span>
    <span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">IApplMsgHandler</span> <span class="n">handler</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">    Attiva un server per lo specifico protocol</span>
<span class="cm">    */</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="unibo-basicomm23-interfaces-iserver">
<h4>unibo.basicomm23.interfaces.IServer<a class="headerlink" href="#unibo-basicomm23-interfaces-iserver" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IServer</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isActive</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">void</span>  <span class="nf">start</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Al momento la factory crea i seguenti server:</p>
<ul class="simple">
<li><p><span class="blue">TcpServer</span>: per il protocollo <code class="docutils literal notranslate"><span class="pre">Tcp</span></code>.</p></li>
<li><p><span class="blue">UdpServer</span>: per il protocollo <code class="docutils literal notranslate"><span class="pre">Udp</span></code>.</p></li>
<li><p><span class="blue">CoapApplServer</span>: per il protocollo <code class="docutils literal notranslate"><span class="pre">Coap</span></code>. Questo server specializza <code class="docutils literal notranslate"><span class="pre">org.eclipse.californium.core.CoapServer</span></code>.</p></li>
</ul>
<p>Nel caso del protocollo <span class="blue">Mqtt</span>, deve essere ovviamente usato uno dei broker disponibili come:</p>
<ul class="simple">
<li><p>“<a class="reference external" href="tcp://broker.hivemq.com">tcp://broker.hivemq.com</a>”</p></li>
<li><p>“<a class="reference external" href="tcp://test.mosquitto.org">tcp://test.mosquitto.org</a>”</p></li>
</ul>
<p>La gestione dei messaggi a livello applicativo
è delegata a un oggetto definito dall’application designer
(si veda <a class="reference internal" href="#unibo-interaction-msg-applmsghandler"><span class="std std-ref">ApplMsgHandler</span></a>,
che implementa l’interfaccia <a class="reference internal" href="#unibo-interaction-interfaces-iapplmsghandler"><span class="std std-ref">IApplMsgHandler</span></a>
secondo il seguente schema architetturale:</p>
<a class="reference internal image-reference" href="_images/AbilitatoreServer.PNG"><img alt="_images/AbilitatoreServer.PNG" class="align-center" src="_images/AbilitatoreServer.PNG" style="width: 70%;" /></a>
</section>
<section id="unibo-basicomm23-enablers-connectionhandler">
<h4>unibo.basicomm23.enablers.ConnectionHandler<a class="headerlink" href="#unibo-basicomm23-enablers-connectionhandler" title="Permalink to this headline">¶</a></h4>
<p>Gestisce i messaggi in arrivo su una connessione e li ridirige all’handler applicativo dato.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConnectionHandler</span> <span class="kd">extends</span> <span class="n">Thread</span><span class="p">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">IApplMsgHandler</span> <span class="n">handler</span> <span class="p">;</span>
    <span class="kd">private</span> <span class="n">Interaction</span> <span class="n">conn</span><span class="p">;</span>

    <span class="kd">public</span> <span class="nf">ConnectionHandler</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">IApplMsgHandler</span> <span class="n">handler</span><span class="p">,</span> <span class="n">Interaction</span> <span class="n">conn</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span>    <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">handler</span> <span class="o">=</span> <span class="n">handler</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">conn</span>    <span class="o">=</span> <span class="n">conn</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">while</span><span class="p">(</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">receiveMsg</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">msg</span> <span class="o">==</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="n">conn</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
                    <span class="n">IApplMessage</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApplMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
                    <span class="n">handler</span><span class="p">.</span><span class="na">elaborate</span><span class="p">(</span> <span class="n">m</span><span class="p">,</span> <span class="n">conn</span> <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span><span class="k">catch</span><span class="p">(</span> <span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span>  <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="esempio-di-creazione-di-un-server">
<h4>Esempio di creazione di un server<a class="headerlink" href="#esempio-di-creazione-di-un-server" title="Permalink to this headline">¶</a></h4>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">IApplMsgHandler</span> <span class="n">chandle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConsumerMsgHandler</span><span class="p">(</span><span class="s">&quot;consumer&quot;</span> <span class="p">);</span>
<span class="n">ServerFactory</span> <span class="n">server</span>    <span class="o">=</span> <span class="k">new</span> <span class="n">ServerFactory</span><span class="p">(</span><span class="s">&quot;server&quot;</span><span class="p">,</span> <span class="mi">8888</span><span class="p">,</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">tcp</span><span class="p">);</span>
<span class="n">server</span><span class="p">.</span><span class="na">addMsgHandler</span><span class="p">(</span><span class="n">chandle</span><span class="p">);</span>
</pre></div>
</div>
<p>Il server pone in esecuzione un consumatore di informazione, la cui logica applicativa è definita nella classe
<span class="blue">ConsumerLogic</span>; la reponsibilità di gestire i messaggi ricevuti dal
<a class="reference internal" href="#unibo-basicomm23-enablers-connectionhandler"><span class="std std-ref">ConnectionHandler</span></a>
è di <span class="blue">ConsumerMsgHandler</span>.</p>
<section id="unibo-basicomm23-examples-prodcons-consumermsghandler">
<h5>unibo.basicomm23.examples.prodcons.ConsumerMsgHandler<a class="headerlink" href="#unibo-basicomm23-examples-prodcons-consumermsghandler" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">ConsumerMsgHandler</span> <span class="n">extends</span> <span class="n">ApplMsgHandler</span> <span class="p">{</span>
<span class="n">private</span> <span class="n">ConsumerLogic</span> <span class="n">conunerLogic</span><span class="p">;</span>
    <span class="n">public</span> <span class="n">ConsumerMsgHandler</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
        <span class="n">conunerLogic</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ConsumerLogic</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">elaborate</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">message</span><span class="p">,</span> <span class="n">Interaction</span> <span class="n">conn</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">d</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">msgContent</span><span class="p">();</span>
            <span class="n">String</span> <span class="n">m</span> <span class="o">=</span> <span class="n">conunerLogic</span><span class="o">.</span><span class="n">evalDistance</span><span class="p">(</span> <span class="n">d</span> <span class="p">)</span> <span class="p">;</span>
            <span class="n">IApplMessage</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">CommUtils</span><span class="o">.</span><span class="n">buildReply</span><span class="p">(</span>
                  <span class="s2">&quot;consumer&quot;</span><span class="p">,</span> <span class="s2">&quot;outdata&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">msgSender</span><span class="p">());</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span> <span class="n">reply</span> <span class="p">);</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="ne">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="slide1">Abilitatori per la trasmissione</span></p>
</section>
</section>
</section>
<section id="actornaivecaller">
<h3>ActorNaiveCaller<a class="headerlink" href="#actornaivecaller" title="Permalink to this headline">¶</a></h3>
<p>Permette a un oggetto applicativo di
inviare messaggi usando uno dei protocolli definiti in <a class="reference internal" href="#unibo-basicomm23-msg-protocoltype"><span class="std std-ref">ProtocolType</span></a>.</p>
<a class="reference internal image-reference" href="_images/AbilitatoreCaller.PNG"><img alt="_images/AbilitatoreCaller.PNG" class="align-center" src="_images/AbilitatoreCaller.PNG" style="width: 35%;" /></a>
<section id="unibo-basicomm23-enablers-actornaivecaller">
<h4>unibo.basicomm23.enablers.ActorNaiveCaller<a class="headerlink" href="#unibo-basicomm23-enablers-actornaivecaller" title="Permalink to this headline">¶</a></h4>
<p>Realizza una prima versione di un attore capace di stabilire una <a class="reference internal" href="Interaction.html#interconnessione"><span class="std std-ref">Interconnessione</span></a> con un server remoto
che opera su un nodo con  <code class="docutils literal notranslate"><span class="pre">hostAddr</span></code> dato.
E’ definito cme una classe astratta che delega alle sue specializzazioni la definizione di un metodo
(<span class="blue">body</span>) che dovrà contenere il funzionamento logico di livello applicativo.</p>
<p>Il <a href="#id1"><span class="problematic" id="id2">*</span></a>body*` verrà eseguito all’interno di un Thread creato dopo una esplicita attivazione
(metodo <span class="blue">activate</span>).
Prima della esecuzione del <a href="#id3"><span class="problematic" id="id4">*</span></a>body*`, il Thread invoca il metodo <span class="blue">connect</span> per stabilire una connessione
di tipo <a class="reference internal" href="#unibo-basicomm23-interfaces-interaction"><span class="std std-ref">Interaction</span></a>
con il server, avvaòendosi di <a class="reference internal" href="#unibo-basicomm23-utils-connectionfactory"><span class="std std-ref">ConnectionFactory</span></a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ActorNaiveCaller</span>
 <span class="kd">protected</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
 <span class="kd">protected</span> <span class="n">Interaction</span> <span class="n">connSupport</span><span class="p">;</span>
 <span class="kd">protected</span> <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">;</span>
 <span class="kd">protected</span> <span class="n">String</span> <span class="n">hostAddr</span><span class="p">;</span>
 <span class="kd">protected</span> <span class="n">String</span> <span class="n">entry</span><span class="p">;</span>
 <span class="kd">protected</span> <span class="kt">boolean</span> <span class="n">connected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

 <span class="kd">public</span> <span class="nf">ActorNaiveCaller</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">String</span> <span class="n">hostAddr</span><span class="p">,</span> <span class="n">String</span> <span class="n">entry</span><span class="p">){</span>
     <span class="k">this</span><span class="p">.</span><span class="na">name</span>     <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
     <span class="k">this</span><span class="p">.</span><span class="na">protocol</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">;</span>
     <span class="k">this</span><span class="p">.</span><span class="na">hostAddr</span> <span class="o">=</span> <span class="n">hostAddr</span><span class="p">;</span>
     <span class="k">this</span><span class="p">.</span> <span class="n">entry</span>   <span class="o">=</span> <span class="n">entry</span><span class="p">;</span>
 <span class="p">}</span>

 <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">body</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>

 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">connect</span><span class="p">(){</span>
     <span class="k">if</span><span class="p">(</span> <span class="n">connected</span> <span class="p">)</span> <span class="k">return</span><span class="p">;</span>
     <span class="n">connected</span>   <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
     <span class="n">connSupport</span> <span class="o">=</span> <span class="n">ConnectionFactory</span><span class="p">.</span><span class="na">createClientSupport23</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">hostAddr</span><span class="p">,</span> <span class="n">entry</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">activate</span><span class="p">(){</span>
     <span class="k">new</span> <span class="n">Thread</span><span class="p">(){</span>
         <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">(){</span>
             <span class="k">try</span> <span class="p">{</span>
                 <span class="n">connect</span><span class="p">();</span>
                 <span class="n">body</span><span class="p">();</span>
               <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{...}</span>
         <span class="p">}</span>
     <span class="p">}.</span><span class="na">start</span><span class="p">();</span>
 <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="esempio-di-actornaivecaller">
<h4>Esempio di ActorNaiveCaller<a class="headerlink" href="#esempio-di-actornaivecaller" title="Permalink to this headline">¶</a></h4>
<p>Definiamo un processo prodttore che invia richieste al consumatore introdotto in <a class="reference internal" href="#esempio-di-creazione-di-un-server"><span class="std std-ref">Esempio di creazione di un server</span></a></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ProducerCaller</span> <span class="n">prod1</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerCaller</span><span class="p">(</span><span class="s">&quot;prod1&quot;</span><span class="p">,</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">tcp</span><span class="p">,</span> <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="s">&quot;8888&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Il <em>ProducerCaller</em> pone in esecuzione un produttore di informazione verso il consumatore.
La logica applicativa del produttore è definita nella classe <span class="blue">ProducerLogic</span>; dunque <em>ProducerCaller</em>
ha solo la responsabilità di inviare messaggi.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProducerCaller</span> <span class="kd">extends</span> <span class="n">ActorNaiveCaller</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">ProducerLogic</span> <span class="n">prodLogic</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerLogic</span><span class="p">();</span>

  <span class="kd">public</span> <span class="nf">ProducerCaller</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">String</span> <span class="n">hostAddr</span><span class="p">,</span> <span class="n">String</span> <span class="n">entry</span><span class="p">){</span>
      <span class="kd">super</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span>   <span class="n">hostAddr</span><span class="p">,</span>   <span class="n">entry</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">body</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span>
      <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
          <span class="n">String</span> <span class="n">d</span>            <span class="o">=</span> <span class="n">prodLogic</span><span class="p">.</span><span class="na">getDistance</span><span class="p">(</span>   <span class="p">);</span>
          <span class="n">IApplMessage</span> <span class="n">req</span>    <span class="o">=</span> <span class="n">CommUtils</span><span class="p">.</span><span class="na">buildRequest</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="s">&quot;distance&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="s">&quot;consumer&quot;</span><span class="p">);</span>
          <span class="n">IApplMessage</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">connSupport</span><span class="p">.</span><span class="na">request</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>  <span class="c1">//raise exception</span>
          <span class="n">CommUtils</span><span class="p">.</span><span class="na">outblue</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; | answer=&quot;</span> <span class="o">+</span> <span class="n">answer</span><span class="p">);</span>
          <span class="n">CommUtils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="slide">Le connessioni</span></p>
</section>
</section>
</section>
<section id="connessioni">
<h2>Connessioni<a class="headerlink" href="#connessioni" title="Permalink to this headline">¶</a></h2>
<p>Gli oggetti di supporto alle comunicazioni creati dalla <a class="reference internal" href="#unibo-basicomm23-utils-connectionfactory"><span class="std std-ref">ConnectionFactory</span></a>
implementano l’interfaccia
<a class="reference internal" href="#unibo-basicomm23-interfaces-interaction"><span class="std std-ref">Interaction</span></a> estendendo una classe astratta che rappresenta
l’idea generale di <a class="reference internal" href="Interaction.html#interconnessione"><span class="std std-ref">Interconnessione</span></a>.</p>
<section id="id5">
<h3>unibo.basicomm23.utils.Connection<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>E’ una classe astratta che implementa le operazioni di  <a class="reference internal" href="#unibo-basicomm23-interfaces-interaction"><span class="std std-ref">Interaction</span></a>
con argomenti di tipo <a class="reference internal" href="#unibo-interaction-interfaces-iapplmessage"><span class="std std-ref">IApplMessage</span></a>,
invocando le omonime operazioni con argomenti <code class="docutils literal notranslate"><span class="pre">String</span></code>, la cui realizzazione è lasciata alle classi
specilizzazione.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Connection</span> <span class="kd">implements</span> <span class="n">Interaction</span> <span class="p">{</span>
  <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">forward</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
       <span class="n">forward</span><span class="p">(</span> <span class="n">msg</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">IApplMessage</span> <span class="nf">request</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ApplMessage</span><span class="p">(</span><span class="n">answer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">IApplMessage</span> <span class="nf">request</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tout</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">TimerForRequest</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimerForRequest</span><span class="p">(</span><span class="n">tout</span><span class="p">);</span>
        <span class="n">t</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>

        <span class="k">new</span> <span class="n">Thread</span><span class="p">(){</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">(){</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">String</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">request</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
                    <span class="n">t</span><span class="p">.</span><span class="na">setExpiredSinceAnswer</span><span class="p">(</span><span class="n">answer</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{...}</span>
            <span class="p">}</span>
        <span class="p">}.</span><span class="na">start</span><span class="p">();</span>
        <span class="n">String</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="na">waitTout</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">answer</span> <span class="o">==</span> <span class="kc">null</span> <span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;request timeout&quot;</span><span class="p">);</span>
        <span class="k">else</span>  <span class="k">return</span> <span class="k">new</span> <span class="n">ApplMessage</span><span class="p">(</span><span class="n">answer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">IApplMessage</span> <span class="nf">receive</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span>
        <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">receiveMsg</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ApplMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reply</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">msg</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">reply</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">forward</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">String</span> <span class="nf">request</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">reply</span><span class="p">(</span><span class="n">String</span> <span class="n">reqid</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">String</span> <span class="nf">receiveMsg</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">close</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="slide1">HttpConnection</span></p>
</section>
<section id="unibo-basicomm23-http-httpconnection">
<h3>unibo.basicomm23.http.HttpConnection<a class="headerlink" href="#unibo-basicomm23-http-httpconnection" title="Permalink to this headline">¶</a></h3>
<p>La implementazione di <a class="reference internal" href="#unibo-basicomm23-interfaces-interaction"><span class="std std-ref">Interaction</span></a> per HTTP non pone particolari problemi:
si tratta di utilizzare una libreria che fornisce un <em>HTTP-client</em>.
Qui continuiamo ad usare la libreria <em>org.apache.http</em>, già introdotta in <a class="reference internal" href="VirtualRobot23.html#virtualrobot23"><span class="std std-ref">VirtualRobot23</span></a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HttpConnection</span> <span class="kd">extends</span> <span class="n">Connection</span> <span class="p">{</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">HttpConnection</span><span class="o">&gt;</span> <span class="n">connMap</span> <span class="o">=</span>
                              <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">HttpConnection</span><span class="o">&gt;</span><span class="p">();</span>
<span class="kd">private</span> <span class="n">HttpClient</span> <span class="n">client</span> <span class="o">=</span>  <span class="n">HttpClients</span><span class="p">.</span><span class="na">createDefault</span><span class="p">();</span>
<span class="kd">private</span>  <span class="n">String</span> <span class="n">URL</span><span class="p">;</span>
<span class="c1">//Factory</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">Interaction</span> <span class="nf">create</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span> <span class="p">){</span>
  <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="n">connMap</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">addr</span><span class="p">)){</span>
    <span class="n">connMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="k">new</span> <span class="n">HttpConnection</span><span class="p">(</span> <span class="n">addr</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">connMap</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//Costruttore</span>
<span class="kd">public</span> <span class="nf">HttpConnection</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="p">)</span> <span class="p">{</span> <span class="n">URL</span> <span class="o">=</span> <span class="s">&quot;http://&quot;</span> <span class="o">+</span><span class="n">url</span><span class="p">;}</span>
</pre></div>
</div>
</section>
<section id="httpconnection-sendhttp">
<h3>HttpConnection.sendHttp<a class="headerlink" href="#httpconnection-sendhttp" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">sendHttp</span><span class="p">(</span> <span class="n">String</span> <span class="n">msgJson</span><span class="p">){</span>
  <span class="p">...</span>
  <span class="n">HttpPost</span> <span class="n">httpPost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="p">(</span> <span class="n">URL</span> <span class="p">);</span>
  <span class="n">httpPost</span><span class="p">.</span><span class="na">setEntity</span><span class="p">(</span><span class="k">new</span> <span class="n">StringEntity</span><span class="p">(</span><span class="n">msgJson</span><span class="p">));</span>
  <span class="n">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">httpPost</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">EntityUtils</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span> <span class="n">response</span><span class="p">.</span><span class="na">getEntity</span><span class="p">()</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il metodo <em>sendHttp</em> è usato per realizzare l’invio di messaggi in forma di <code class="docutils literal notranslate"><span class="pre">String</span></code>.</p>
</section>
<section id="httpconnection-specializza-connection">
<h3>HttpConnection specializza Connection<a class="headerlink" href="#httpconnection-specializza-connection" title="Permalink to this headline">¶</a></h3>
<p>I metodi di <a class="reference internal" href="#unibo-basicomm23-interfaces-interaction"><span class="std std-ref">Interaction</span></a> con aromenti <code class="docutils literal notranslate"><span class="pre">String</span></code> sono
realizzati nella sola forma sincrona. I metodi <code class="docutils literal notranslate"><span class="pre">reply</span></code> e <code class="docutils literal notranslate"><span class="pre">receiveMsg</span></code> solo al di fuori
del modello di interazione <code class="docutils literal notranslate"><span class="pre">HTTP</span></code> e quindi la loro chiamata provoca una eccezione.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">request</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">sendHttp</span><span class="p">(</span> <span class="n">msg</span> <span class="p">);</span>
<span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">forward</span><span class="p">(</span> <span class="n">String</span> <span class="n">msg</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
  <span class="n">sendHttp</span><span class="p">(</span> <span class="n">msg</span> <span class="p">);</span> <span class="c1">//answer ingnored</span>
<span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">reply</span><span class="p">(</span><span class="n">String</span> <span class="n">msgJson</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
 <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;HttpConnection does not implement reply&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">receiveMsg</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
 <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;HttpConnection does not implement receiveMsg&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="esperimenti-httpconnection">
<h4>Esperimenti HTTPConnection<a class="headerlink" href="#esperimenti-httpconnection" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">void</span> <span class="n">doForwardHttp</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
     <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionFactory</span><span class="o">.</span><span class="n">createClientSupport</span><span class="p">(</span>
            <span class="n">ProtocolType</span><span class="o">.</span><span class="n">http</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;8090/api/move&quot;</span><span class="p">);</span>
     <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">forwardcmd</span><span class="p">);</span>
     <span class="n">CommUtils</span><span class="o">.</span><span class="n">outblue</span><span class="p">(</span><span class="s2">&quot;doForwardHttp result=&quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Eseguiamo il test ponendo il robot in due stati iniziali diversi.</p>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><img alt="_images/RobotAtHome.png" src="_images/RobotAtHome.png" />
</td>
<td><p>Robot in HOME. La mossa termina con successo.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s">&quot;endmove&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">:</span><span class="s">&quot;moveForward&quot;</span><span class="p">}</span> <span class="n">time</span><span class="o">=</span><span class="mf">1.08</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><img alt="_images/RobotNearWallDown.png" src="_images/RobotNearWallDown.png" />
</td>
<td><p>Robot vicino  a <code class="docutils literal notranslate"><span class="pre">wallDown</span></code>. Il robot collide con la parete.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s">&quot;endmove&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">:</span><span class="s">&quot;moveForward-collision&quot;</span><span class="p">}</span> <span class="n">time</span><span class="o">=</span><span class="mf">1.071</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Essendo la comunicazione sincrona, le risposte vengono sempre ricevute dopo la durata della mossa (1 sec).</p>
<a class="reference internal image-reference" href="_images/forwardOk.png"><img alt="_images/forwardOk.png" src="_images/forwardOk.png" style="width: 80%;" /></a>
<p><span class="slide1">WsConnection</span></p>
<p>La implementazione di <a class="reference internal" href="#unibo-basicomm23-interfaces-interaction"><span class="std std-ref">Interaction</span></a>
per WS (WebSocket) induce a modifiche rilevanti nella struttura del codice applicativo,
in quanto le interazioni sono <span class="blue">asincrone</span>.  Inoltre,
su una WS-connection possono giungere informazioni
che sono risposte a messaggi inviati in precedenza o anche di altro tipo
(ad esempio dati di un sensore, allarmi, <a class="reference internal" href="VirtualRobot23.html#messaggio-di-stato"><span class="std std-ref">Messaggi di stato</span></a>, etc.).</p>
<p>Per meglio gestire queste informazioni in ingresso,
questo tipo di connessione è stato realizzato come un <span class="blue">POJO  osservabile</span>
(che implementa <a class="reference internal" href="#unibo-basicomm23-interfaces-iobservable"><span class="std std-ref">IObservable</span></a>),
in modo da permettere al livello
applicativo di gestire i messaggi in arrivo da parte di ossservatori
che implementano <a class="reference internal" href="#unibo-basicomm23-interfaces-iobserver"><span class="std std-ref">IObserver</span></a>.</p>
</section>
</section>
<section id="unibo-basicomm23-ws-wsconnection">
<h3>unibo.basicomm23.ws.WsConnection<a class="headerlink" href="#unibo-basicomm23-ws-wsconnection" title="Permalink to this headline">¶</a></h3>
<p>Implementa il concetto di <a class="reference internal" href="Interaction.html#interconnessione"><span class="std std-ref">Interconnessione</span></a>
(interfaccia <a class="reference internal" href="#unibo-basicomm23-interfaces-interaction"><span class="std std-ref">Interaction</span></a>)
su <code class="docutils literal notranslate"><span class="pre">WebSocket</span></code>, utilizzando la libreria <code class="docutils literal notranslate"><span class="pre">javax.websocket</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ClientEndpoint</span>  <span class="c1">//Richiesto da javax.websocket</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WsConnection</span>  <span class="kd">implements</span> <span class="n">Interaction</span><span class="p">,</span> <span class="n">IObservable</span><span class="p">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">WsConnection</span><span class="o">&gt;</span> <span class="n">connMap</span><span class="o">=</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">WsConnection</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="kd">private</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">IObserver</span><span class="o">&gt;</span> <span class="n">observers</span><span class="o">=</span> <span class="k">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">IObserver</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="kd">private</span> <span class="n">Session</span> <span class="n">userSession</span>    <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">...</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">WsConnection</span> <span class="nf">create</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span> <span class="p">){</span>
    <span class="c1">//Crea una nuova connessione, memorizzandola in connMap</span>
    <span class="p">...</span>
    <span class="n">connMap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="k">new</span> <span class="n">WsConnection</span><span class="p">(</span> <span class="n">addr</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>

  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="wsconnection-come-iobservable">
<h4>WsConnection come IObservable<a class="headerlink" href="#wsconnection-come-iobservable" title="Permalink to this headline">¶</a></h4>
<p>Per permettere la gestione di messaggi inviati dal server al client
(ocme i <a class="reference internal" href="VirtualRobot23.html#messaggio-di-stato"><span class="std std-ref">Messaggi di stato</span></a>),
questa connessione viene definita come <span class="blue">observable</span>, secondo l’interfaccia
<a class="reference internal" href="#unibo-basicomm23-interfaces-iobservable"><span class="std std-ref">IObservable</span></a>, e quindi definisce metodi per aggiungere e togliere
observer applicativi.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addObserver</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">obs</span><span class="p">)</span> <span class="p">{</span> <span class="n">observers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span> <span class="n">obs</span><span class="p">);</span> <span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteObserver</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">obs</span><span class="p">)</span> <span class="p">{</span> <span class="n">observers</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span> <span class="n">obs</span><span class="p">);</span> <span class="p">}</span>

<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updateObservers</span><span class="p">(</span> <span class="n">String</span> <span class="n">msg</span> <span class="p">){</span>
    <span class="n">observers</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="n">v</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="wsconnection-il-costruttore">
<h4>WsConnection il costruttore<a class="headerlink" href="#wsconnection-il-costruttore" title="Permalink to this headline">¶</a></h4>
<p>Il costruttore privato realizza la connessione all’indirizzo dato.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="nf">WsConnection</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//addr del tipo: localhost:8091</span>
  <span class="n">wsconnect</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">wsconnect</span><span class="p">(</span><span class="n">String</span> <span class="n">wsAddr</span><span class="p">){</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">WebSocketContainer</span> <span class="n">container</span> <span class="o">=</span> <span class="n">ContainerProvider</span><span class="p">.</span><span class="na">getWebSocketContainer</span><span class="p">();</span>
        <span class="n">URI</span> <span class="n">uri</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URI</span><span class="p">(</span><span class="s">&quot;ws://&quot;</span><span class="o">+</span><span class="n">wsAddr</span><span class="p">);</span>
        <span class="n">container</span><span class="p">.</span><span class="na">connectToServer</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">uri</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{...}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="wsconnection-sendmessage">
<h4>WsConnection: sendMessage<a class="headerlink" href="#wsconnection-sendmessage" title="Permalink to this headline">¶</a></h4>
<p>Il metodo <code class="docutils literal notranslate"><span class="pre">sendMessage</span></code> incapsula i dettagli relativi all’invio di un messaggio <code class="docutils literal notranslate"><span class="pre">String</span></code> sulla <code class="docutils literal notranslate"><span class="pre">WS</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendMessage</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span> <span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
  <span class="c1">//this.userSession.getAsyncRemote().sendText(message);</span>
  <span class="k">this</span><span class="p">.</span><span class="na">userSession</span><span class="p">.</span><span class="na">getBasicRemote</span><span class="p">().</span><span class="na">sendText</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="c1">//synch: blocks until msg transmitted</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="wsconnection-gestione-degli-eventi">
<h4>WsConnection: gestione degli eventi<a class="headerlink" href="#wsconnection-gestione-degli-eventi" title="Permalink to this headline">¶</a></h4>
<p>Come richiesto dalla libreria <code class="docutils literal notranslate"><span class="pre">javax.websocket</span></code>, si definiscono metodi annotati per la gestione degli eventi
di apertura/chiusura di connessione e di ricezione di un messaggio.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@OnOpen</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onOpen</span><span class="p">(</span><span class="n">Session</span> <span class="n">userSession</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="na">userSession</span> <span class="o">=</span> <span class="n">userSession</span><span class="p">;</span> <span class="p">}</span>
<span class="nd">@OnClose</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClose</span><span class="p">(</span><span class="n">Session</span> <span class="n">userSession</span><span class="p">,</span> <span class="n">CloseReason</span> <span class="n">reason</span><span class="p">)</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="na">userSession</span><span class="o">=</span><span class="kc">null</span><span class="p">;}</span>
<span class="nd">@OnMessage</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span>   <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">messageHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="na">messageHandler</span><span class="p">.</span><span class="na">handleMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il metodo <code class="docutils literal notranslate"><span class="pre">onMessage</span></code> delega la gestione del messaggio ricevuto  all’handler che
aggiorna gli observer applicativi.</p>
</section>
<section id="wsconnection-specializza-connection">
<h4>WsConnection specializza Connection<a class="headerlink" href="#wsconnection-specializza-connection" title="Permalink to this headline">¶</a></h4>
<p>La realizzazione dei metodi di <a class="reference internal" href="#unibo-basicomm23-interfaces-interaction"><span class="std std-ref">Interaction</span></a> con argomenti <code class="docutils literal notranslate"><span class="pre">String</span></code>
è parziale, in quanto viene esclusa la possibilità di realizzare operazioni sincrone,
che verranno, nel caso, ottenute a livello applicativo,
con l’intervento di observer in grado di gestire i <a class="reference internal" href="VirtualRobot23.html#messaggio-di-stato"><span class="std std-ref">Messaggi di stato</span></a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">forward</span><span class="p">(</span> <span class="n">String</span> <span class="n">msg</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
      <span class="n">sendMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">request</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;WsConnectio: request not allowed&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">reply</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
  <span class="n">forward</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">receiveMsg</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
  <span class="c1">//Related to onMessage</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;WsConnectio: receiveMsg not allowed&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="esperimenti-wsconnection">
<h4>Esperimenti WSConnection<a class="headerlink" href="#esperimenti-wsconnection" title="Permalink to this headline">¶</a></h4>
<p>Per sperimentare l’uso del supporto, eseguiamo due test: uno relativo alla esecuzione con successo ed
uno che provoca fallimento, dovuto a collisione.</p>
<p>Il codice ha la forma che segue:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">addr</span>          <span class="o">=</span> <span class="s">&quot;localhost:8091&quot;</span><span class="p">;</span>
<span class="n">Interaction</span> <span class="n">connWs</span>   <span class="o">=</span> <span class="n">WsConnection</span><span class="p">.</span><span class="na">create</span><span class="p">(</span> <span class="n">addr</span> <span class="p">);</span>
<span class="n">connWs</span><span class="p">.</span><span class="na">addObserver</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">//applicazione che funge da observer sulla WebSocket</span>

<span class="n">String</span> <span class="n">forwardcmd</span> <span class="o">=</span> <span class="s">&quot;{\&quot;robotmove\&quot;:\&quot;moveForward\&quot;,\&quot;time\&quot;:\&quot;1000\&quot;}&quot;</span><span class="p">;</span>
<span class="n">sendMessage</span><span class="p">(</span>  <span class="n">forwardcmd</span>  <span class="p">);</span>   <span class="c1">//ASINCRONO =&gt; no answer</span>
</pre></div>
</div>
<p>Poichè WsConnection è <a class="reference internal" href="#wsconnection-come-iobservable"><span class="std std-ref">Observable</span></a>, la gestione dei messaggi
inviati dal server è definita nel metodo <code class="docutils literal notranslate"><span class="pre">update</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">String</span> <span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CommUtils</span><span class="p">.</span><span class="na">outmagenta</span><span class="p">(</span><span class="s">&quot;observerd &quot;</span><span class="p">:</span><span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Eseguiamo dunque il test ponendo il robot in due stati iniziali diversi.</p>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><img alt="_images/RobotAtHome.png" src="_images/RobotAtHome.png" />
</td>
<td><p>Robot in HOME. La mossa termina con successo.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">observerd</span> <span class="p">{</span><span class="s">&quot;endmove&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">:</span><span class="s">&quot;moveForward&quot;</span><span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><img alt="_images/RobotNearWallDown.png" src="_images/RobotNearWallDown.png" />
</td>
<td><p>Robot vicino  a <code class="docutils literal notranslate"><span class="pre">wallDown</span></code>. Il robot collide con la parete.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">observerd</span> <span class="p">{</span><span class="s">&quot;collision&quot;</span><span class="p">:</span><span class="s">&quot;moveForward&quot;</span><span class="p">,</span><span class="s">&quot;target&quot;</span><span class="p">:</span><span class="s">&quot;wallDown&quot;</span><span class="p">}</span>
<span class="n">observerd</span> <span class="p">{</span><span class="s">&quot;endmove&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="s">&quot;move&quot;</span><span class="p">:</span><span class="s">&quot;moveForward-collision&quot;</span><span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Essendo la comunicazione asincrona, il <a class="reference internal" href="VirtualRobot23.html#messaggio-di-stato"><span class="std std-ref">Messaggip di stato</span></a> inviato da WEnv
viene elaborato dall’osservatore posto sulla connessione.</p>
<a class="reference internal image-reference" href="_images/forwardCollision.png"><img alt="_images/forwardCollision.png" src="_images/forwardCollision.png" style="width: 90%;" /></a>
<p><span class="slide1">CoapConnection</span></p>
</section>
</section>
</section>
<section id="unibo-basicomm23-coap-coapconnection">
<h2>unibo.basicomm23.coap.CoapConnection<a class="headerlink" href="#unibo-basicomm23-coap-coapconnection" title="Permalink to this headline">¶</a></h2>
<p>TODO: Si veda <a class="reference internal" href="AppuntiTecnologie.html#coap"><span class="std std-ref">CoAP</span></a></p>
<p><span class="slide">Supporti</span></p>
</section>
<section id="altri-contratti-e-supporti">
<h2>Altri contratti e supporti<a class="headerlink" href="#altri-contratti-e-supporti" title="Permalink to this headline">¶</a></h2>
<p><span class="slide1">Osservabili e osservatori</span></p>
<section id="unibo-basicomm23-interfaces-iobserver">
<h3>unibo.basicomm23.interfaces.IObserver<a class="headerlink" href="#unibo-basicomm23-interfaces-iobserver" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IObserver</span> <span class="kd">extends</span> <span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">Observer</span><span class="p">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span> <span class="n">String</span> <span class="n">value</span> <span class="p">);</span>
  <span class="c1">//From Observer: public void update(Observable o, Object news)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notiamo che <code class="docutils literal notranslate"><span class="pre">java.util.Observer</span></code> è <span class="blue">deprecated</span> da <strong>Java9</strong> in avanti.  Dovremo approfondire le ragioni di ciò,
ma al momento osserviamo che non viene messa in discussione l’idea di osservabilità, ma solo il modo
in cui viene realizzata nel mondo della <em>oop classica</em>.</p>
</section>
<section id="unibo-basicomm23-interfaces-iobservable">
<h3>unibo.basicomm23.interfaces.IObservable<a class="headerlink" href="#unibo-basicomm23-interfaces-iobservable" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IObservable</span>  <span class="p">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addObserver</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">obs</span> <span class="p">);</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteObserver</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">obs</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La classe <code class="docutils literal notranslate"><span class="pre">java.util.Observable</span></code> implementa i metodi di <em>IObservable</em>, in quanto
<a class="reference internal" href="#unibo-basicomm23-interfaces-iobserver"><span class="std std-ref">IObserver</span></a> estende <code class="docutils literal notranslate"><span class="pre">java.util.Observer</span></code>.</p>
</section>
<section id="unibo-basicomm23-utilsapplabstractobserver">
<h3>unibo.basicomm23.utilsApplAbstractObserver<a class="headerlink" href="#unibo-basicomm23-utilsapplabstractobserver" title="Permalink to this headline">¶</a></h3>
<p>La classe astratta <code class="docutils literal notranslate"><span class="pre">unibo.basicomm23.utils.ApplAbstractObserver</span></code> fornisce lo scheletro di un observer
che implementa <a class="reference internal" href="#unibo-basicomm23-interfaces-iobserver"><span class="std std-ref">IObserver</span></a>, lasciando non specificato
il metodo <code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">void</span> <span class="pre">update(String</span> <span class="pre">msg)</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">abstract</span>  <span class="k">class</span> <span class="nc">ApplAbstractObserver</span> <span class="n">implements</span> <span class="n">IObserver</span><span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="n">public</span> <span class="n">void</span> <span class="n">update</span><span class="p">(</span><span class="n">Observable</span> <span class="n">o</span><span class="p">,</span> <span class="n">Object</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">update</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">toString</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="nd">@Override</span>
  <span class="n">public</span> <span class="n">abstract</span> <span class="n">void</span> <span class="n">update</span><span class="p">(</span><span class="n">String</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="slide1">Messaggi</span></p>
</section>
<section id="unibo-interaction-msg-applmessage">
<h3>unibo.interaction.msg.ApplMessage<a class="headerlink" href="#unibo-interaction-msg-applmessage" title="Permalink to this headline">¶</a></h3>
<p>Quesat è la classe di utilità che implementa <a class="reference internal" href="#unibo-interaction-interfaces-iapplmessage"><span class="std std-ref">IApplMessage</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">ApplMessage</span> <span class="n">implements</span> <span class="n">IApplMessage</span> <span class="p">{</span>

  <span class="o">//</span><span class="n">Costruttori</span>
  <span class="n">public</span> <span class="n">ApplMessage</span><span class="p">(</span> <span class="n">String</span> <span class="n">MSGID</span><span class="p">,</span> <span class="n">String</span> <span class="n">MSGTYPE</span><span class="p">,</span>
      <span class="n">String</span> <span class="n">SENDER</span><span class="p">,</span> <span class="n">String</span> <span class="n">RECEIVER</span><span class="p">,</span> <span class="n">String</span> <span class="n">CONTENT</span><span class="p">,</span> <span class="n">String</span> <span class="n">SEQNUM</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span>  <span class="p">}</span>
  <span class="n">public</span> <span class="n">ApplMessage</span><span class="p">(</span> <span class="n">String</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">Struct</span> <span class="n">msgStruct</span> <span class="o">=</span> <span class="p">(</span><span class="n">Struct</span><span class="p">)</span> <span class="n">Term</span><span class="o">.</span><span class="n">createTerm</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
      <span class="o">...</span>
  <span class="p">}</span>
  <span class="o">//</span><span class="n">Predicati</span>
  <span class="n">public</span> <span class="n">boolean</span> <span class="n">isDispatch</span><span class="p">(){</span>
      <span class="k">return</span> <span class="n">msgType</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span> <span class="n">ApplMessageType</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="n">public</span> <span class="n">boolean</span> <span class="n">isRequest</span><span class="p">(){</span> <span class="o">...</span> <span class="p">}</span>
  <span class="n">public</span> <span class="n">boolean</span> <span class="n">isReply</span><span class="p">(){</span> <span class="o">...</span> <span class="p">}</span>
  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="unibo-interaction-msg-applmsghandler">
<h3>unibo.interaction.msg.ApplMsgHandler<a class="headerlink" href="#unibo-interaction-msg-applmsghandler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">abstract</span> <span class="k">class</span> <span class="nc">ApplMsgHandler</span> <span class="n">implements</span> <span class="n">IApplMsgHandler</span> <span class="p">{</span>
<span class="n">protected</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>

  <span class="n">public</span> <span class="n">ApplMsgHandler</span><span class="p">(</span> <span class="n">String</span> <span class="n">name</span>  <span class="p">)</span> <span class="p">{</span>  <span class="n">this</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">public</span> <span class="n">String</span> <span class="n">getName</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">name</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">public</span> <span class="n">abstract</span> <span class="n">void</span> <span class="n">elaborate</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">message</span><span class="p">,</span> <span class="n">Interaction</span>  <span class="n">conn</span><span class="p">)</span> <span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="slide1">CommUtils</span></p>
</section>
</section>
<section id="unibo-basicomm23-utils-commutils">
<h2>unibo.basicomm23.utils.CommUtils<a class="headerlink" href="#unibo-basicomm23-utils-commutils" title="Permalink to this headline">¶</a></h2>
<p>Nel package <code class="docutils literal notranslate"><span class="pre">utils</span></code> del progetto, viene definita la classe <em>CommUtils</em>  che definisce
vari metodi <em>static</em> di utilità.</p>
<section id="metodi-di-uso-comune">
<h3>Metodi di uso comune<a class="headerlink" href="#metodi-di-uso-comune" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">delay(Int)</span></code>: per sospendere l’esecuzione del Thred corrente</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">outxxx(String)</span></code>, con <code class="docutils literal notranslate"><span class="pre">xxx=blue,red,grenn,yellow,</span> <span class="pre">...</span></code> per visualizzare messaggi colorati su <code class="docutils literal notranslate"><span class="pre">System.out</span></code>,
una feature che risultà utile per differenzare le informazioni emesse dai diversi componenti delle nostre applicazioni</p></li>
</ul>
</section>
<section id="metodi-per-la-costruzione-di-messaggi">
<h3>Metodi per la costruzione di messaggi<a class="headerlink" href="#metodi-per-la-costruzione-di-messaggi" title="Permalink to this headline">¶</a></h3>
<p>La classe definisce anche metodi statici che agevolano la costruzione e l’invio di
<a class="reference internal" href="Interaction.html#natura-e-struttura-dei-messaggi-applicativi"><span class="std std-ref">messaggi applicativi</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">JSONObject</span> <span class="n">parseForJson</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span>
<span class="n">IApplMessage</span> <span class="n">buildDispatch</span><span class="p">(</span><span class="n">String</span> <span class="n">sender</span><span class="p">,</span> <span class="n">String</span> <span class="n">msgId</span><span class="p">,</span> <span class="n">String</span> <span class="n">payload</span><span class="p">,</span> <span class="n">String</span> <span class="n">dest</span><span class="p">)</span>
<span class="n">IApplMessage</span> <span class="n">buildRequest</span><span class="p">(</span><span class="n">String</span> <span class="n">sender</span><span class="p">,</span> <span class="n">String</span> <span class="n">msgId</span><span class="p">,</span> <span class="n">String</span> <span class="n">payload</span><span class="p">,</span> <span class="n">String</span> <span class="n">dest</span><span class="p">)</span>
<span class="n">IApplMessage</span> <span class="n">buildReply</span><span class="p">(</span><span class="n">String</span> <span class="n">sender</span><span class="p">,</span> <span class="n">String</span> <span class="n">msgId</span><span class="p">,</span> <span class="n">String</span> <span class="n">payload</span><span class="p">,</span> <span class="n">String</span> <span class="n">dest</span><span class="p">)</span>
<span class="n">IApplMessage</span> <span class="n">prepareReply</span><span class="p">(</span><span class="n">IApplMessage</span> <span class="n">requestMsg</span><span class="p">,</span> <span class="n">String</span> <span class="n">answer</span><span class="p">)</span>
</pre></div>
</div>
<p>Il metodo <code class="docutils literal notranslate"><span class="pre">prepareReply</span></code> confeziona una reply relativa alla <code class="docutils literal notranslate"><span class="pre">requestMsg</span></code> data in ingresso, da cui
determina il nome del chiamante.</p>
</section>
<section id="metodi-per-modificare-stringhe-messaggio">
<h3>Metodi per modificare stringhe-messaggio<a class="headerlink" href="#metodi-per-modificare-stringhe-messaggio" title="Permalink to this headline">¶</a></h3>
<p>La trasmissione/ricezione di stringhe che contengono <code class="docutils literal notranslate"><span class="pre">\n</span></code> può spesso portare a malfunzionamenti.
Conviene dunque sostituire il carattere in trasmissione, per poi ripristinarlo in ricezione.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">public</span> <span class="n">static</span> <span class="n">String</span> <span class="n">convertToSend</span><span class="p">(</span><span class="n">String</span> <span class="n">s</span><span class="p">){</span>
              <span class="k">return</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">+</span><span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;@!@&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">public</span> <span class="n">static</span> <span class="n">String</span> <span class="n">restoreFromConvertToSend</span><span class="p">(</span><span class="n">String</span> <span class="n">s</span><span class="p">){</span>
  <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@!@&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="slide">Esempi di uso</span></p>
</section>
</section>
<section id="esempi-di-uso-di-basicomm23">
<h2>Esempi di uso di basicomm23<a class="headerlink" href="#esempi-di-uso-di-basicomm23" title="Permalink to this headline">¶</a></h2>
<p>Un sistema produttore-consumatore.</p>
<p>Facendo riferimento a <a class="reference internal" href="#esempio-di-actornaivecaller"><span class="std std-ref">Esempio di ActorNaiveCaller</span></a> e <a class="reference internal" href="#esempio-di-creazione-di-un-server"><span class="std std-ref">Esempio di creazione di un server</span></a>,
definiamo un main program di configurazione del sistema.</p>
<section id="unibo-basicomm23-examples-mainprodcons">
<h3>unibo.basicomm23.examples.MainProdCons<a class="headerlink" href="#unibo-basicomm23-examples-mainprodcons" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainProdCons</span> <span class="p">{</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureTheSystem</span><span class="p">(){</span>
    <span class="n">String</span> <span class="n">hostAddr</span>       <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">port</span>              <span class="o">=</span> <span class="mi">8888</span><span class="p">;</span>
    <span class="n">ProtocolType</span> <span class="n">protocol</span> <span class="o">=</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">tcp</span><span class="p">;</span>

    <span class="c1">//Sottosistemi di produzione</span>
    <span class="n">ProducerLogic</span> <span class="n">prodLogic</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProducerLogic</span><span class="p">();</span>
    <span class="n">ProducerCaller</span> <span class="n">prod1</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">ProducerCaller</span><span class="p">(</span><span class="s">&quot;prod1&quot;</span><span class="p">,</span> <span class="n">prodLogic</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">hostAddr</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">port</span><span class="p">);</span>
    <span class="n">ProducerCaller</span> <span class="n">prod2</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">ProducerCaller</span><span class="p">(</span><span class="s">&quot;prod2&quot;</span><span class="p">,</span> <span class="n">prodLogic</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">hostAddr</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">port</span><span class="p">);</span>

    <span class="c1">//Sottosistmea di consumazione</span>
    <span class="n">ConsumerLogic</span> <span class="n">consunerLogic</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConsumerLogic</span><span class="p">();</span>
    <span class="n">IApplMsgHandler</span> <span class="n">chandle</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">ConsumerMsgHandler</span><span class="p">(</span><span class="s">&quot;consumerhanlder&quot;</span><span class="p">,</span> <span class="n">consunerLogic</span> <span class="p">);</span>
    <span class="n">ServerFactory</span> <span class="n">server</span>    <span class="o">=</span> <span class="k">new</span> <span class="n">ServerFactory</span><span class="p">(</span><span class="s">&quot;server&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">protocol</span><span class="p">);</span>
    <span class="n">server</span><span class="p">.</span><span class="na">addMsgHandler</span><span class="p">(</span><span class="n">chandle</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span> <span class="p">){</span>
    <span class="k">new</span> <span class="n">MainProdCons</span><span class="p">().</span><span class="na">configureTheSystem</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="slide1">Attori</span></p>
</section>
<section id="verso-gli-attori">
<h3>Verso gli attori<a class="headerlink" href="#verso-gli-attori" title="Permalink to this headline">¶</a></h3>
<p>Una specifica più compatta del sistema si ottiene incapsulando in opportune classi le configurazioni
dei sottosistemi di produzione e consumazione.</p>
<a class="reference internal image-reference" href="_images/ProdCons.PNG"><img alt="_images/ProdCons.PNG" class="align-center" src="_images/ProdCons.PNG" style="width: 55%;" /></a>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureTheSystem</span><span class="p">(){</span>
    <span class="n">ProdConsConfig</span><span class="p">.</span><span class="na">setProtocol</span><span class="p">(</span><span class="n">ProtocolType</span><span class="p">.</span><span class="na">tcp</span><span class="p">);</span>
    <span class="c1">//Create the producers</span>
    <span class="n">Producer</span> <span class="n">producer1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="p">(</span><span class="s">&quot;prod1&quot;</span><span class="p">);</span>
    <span class="n">Producer</span> <span class="n">producer2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Producer</span><span class="p">(</span><span class="s">&quot;prod2&quot;</span><span class="p">);</span>
    <span class="c1">//Create the consumer</span>
    <span class="n">Consumer</span> <span class="n">consumer</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">Consumer</span><span class="p">(</span><span class="s">&quot;consumer&quot;</span><span class="p">);</span>
    <span class="c1">//Activate</span>
    <span class="n">consumer</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
    <span class="n">producer1</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
    <span class="n">producer2</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Le classi <code class="docutils literal notranslate"><span class="pre">Producer</span></code> e <code class="docutils literal notranslate"><span class="pre">Consumer</span></code> sono primi esempi di <span class="blue">actor</span>,  inteso come un componente attivo
in grado di inviare/ricevere messaggi.</p>
<ul class="simple">
<li><p>La logica applicativa non dipende dal protocollo di comunicazione, nè lato client, nè lato server.</p></li>
<li><p>Per ottenere un sistema basato su un diverso protocollo, basta modificare la frase
<code class="docutils literal notranslate"><span class="pre">ProdConsConfig.setProtocol(ProtocolType.tcp)</span></code></p></li>
</ul>
</section>
<section id="producer">
<h3>Producer<a class="headerlink" href="#producer" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">Producer</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">ProducerCaller</span> <span class="n">prodCaller</span><span class="p">;</span>

    <span class="n">public</span> <span class="n">Producer</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">){</span>
        <span class="n">ProducerLogic</span> <span class="n">prodLogic</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ProducerLogic</span><span class="p">();</span>
        <span class="n">prodCaller</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ProducerCaller</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">prodLogic</span><span class="p">,</span>
            <span class="n">ProdConsConfig</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="n">ProdConsConfig</span><span class="o">.</span><span class="n">hostAddr</span><span class="p">,</span> <span class="n">ProdConsConfig</span><span class="o">.</span><span class="n">entry</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">start</span><span class="p">(){</span>
        <span class="n">prodCaller</span><span class="o">.</span><span class="n">activate</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="consumer">
<h3>Consumer<a class="headerlink" href="#consumer" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">Consumer</span> <span class="p">{</span>
  <span class="n">private</span> <span class="n">ServerFactory</span> <span class="n">server</span><span class="p">;</span>

  <span class="n">public</span> <span class="n">Consumer</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">){</span>
      <span class="n">ConsumerLogic</span> <span class="n">consunerLogic</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ConsumerLogic</span><span class="p">();</span>
      <span class="n">IApplMsgHandler</span> <span class="n">chandle</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">ProdConsConfig</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="n">ProtocolType</span><span class="o">.</span><span class="n">coap</span> <span class="p">)</span>
          <span class="n">chandle</span><span class="o">=</span><span class="n">new</span> <span class="n">ConsumerCoapResource</span><span class="p">(</span><span class="s2">&quot;consumer&quot;</span><span class="p">,</span> <span class="n">consunerLogic</span> <span class="p">);</span>
      <span class="k">else</span> <span class="n">chandle</span><span class="o">=</span><span class="n">new</span> <span class="n">ConsumerMsgHandler</span><span class="p">(</span><span class="s2">&quot;consumerhanlder&quot;</span><span class="p">,</span> <span class="n">consunerLogic</span> <span class="p">);</span>
      <span class="n">server</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ServerFactory</span><span class="p">(</span>
              <span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="n">ProdConsConfig</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">ProdConsConfig</span><span class="o">.</span><span class="n">protocol</span><span class="p">);</span>
      <span class="n">server</span><span class="o">.</span><span class="n">addMsgHandler</span><span class="p">(</span><span class="n">chandle</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">public</span> <span class="n">void</span> <span class="n">start</span><span class="p">(){</span>
      <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<a class="reference internal image-reference" href="_images/ProdConsEspansa.PNG"><img alt="_images/ProdConsEspansa.PNG" class="align-center" src="_images/ProdConsEspansa.PNG" style="width: 85%;" /></a>
</section>
<section id="unibo-basicomm23-examples-pingpong">
<h3>unibo.basicomm23.examples.pingpong<a class="headerlink" href="#unibo-basicomm23-examples-pingpong" title="Permalink to this headline">¶</a></h3>
<p><span class="worktodo">TODO: creare un simulatore di ping-pong</span></p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">unibo.basicomm23</a><ul>
<li><a class="reference internal" href="#unibo-basicomm23-interfaces">unibo.basicomm23.interfaces</a><ul>
<li><a class="reference internal" href="#unibo-basicomm23-interfaces-interaction">unibo.basicomm23.interfaces.Interaction</a></li>
<li><a class="reference internal" href="#unibo-interaction-interfaces-iapplmessage">unibo.interaction.interfaces.IApplMessage</a></li>
<li><a class="reference internal" href="#unibo-interaction-interfaces-iapplmsghandler">unibo.interaction.interfaces.IApplMsgHandler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unibo-basicomm23-msg-protocoltype">unibo.basicomm23.msg.ProtocolType</a><ul>
<li><a class="reference internal" href="#unibo-basicomm23-utils-connectionfactory">unibo.basicomm23.utils.ConnectionFactory</a></li>
<li><a class="reference internal" href="#unibo-basicomm23-utils-connection">unibo.basicomm23.utils.Connection</a><ul>
<li><a class="reference internal" href="#connection-trace">Connection.trace</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#abilitatori-di-comunicazione">Abilitatori di comunicazione</a><ul>
<li><a class="reference internal" href="#serverfactory">ServerFactory</a><ul>
<li><a class="reference internal" href="#unibo-basicomm23-enablers-severfactory">unibo.basicomm23.enablers.SeverFactory</a></li>
<li><a class="reference internal" href="#unibo-basicomm23-interfaces-iserver">unibo.basicomm23.interfaces.IServer</a></li>
<li><a class="reference internal" href="#unibo-basicomm23-enablers-connectionhandler">unibo.basicomm23.enablers.ConnectionHandler</a></li>
<li><a class="reference internal" href="#esempio-di-creazione-di-un-server">Esempio di creazione di un server</a><ul>
<li><a class="reference internal" href="#unibo-basicomm23-examples-prodcons-consumermsghandler">unibo.basicomm23.examples.prodcons.ConsumerMsgHandler</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#actornaivecaller">ActorNaiveCaller</a><ul>
<li><a class="reference internal" href="#unibo-basicomm23-enablers-actornaivecaller">unibo.basicomm23.enablers.ActorNaiveCaller</a></li>
<li><a class="reference internal" href="#esempio-di-actornaivecaller">Esempio di ActorNaiveCaller</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#connessioni">Connessioni</a><ul>
<li><a class="reference internal" href="#id5">unibo.basicomm23.utils.Connection</a></li>
<li><a class="reference internal" href="#unibo-basicomm23-http-httpconnection">unibo.basicomm23.http.HttpConnection</a></li>
<li><a class="reference internal" href="#httpconnection-sendhttp">HttpConnection.sendHttp</a></li>
<li><a class="reference internal" href="#httpconnection-specializza-connection">HttpConnection specializza Connection</a><ul>
<li><a class="reference internal" href="#esperimenti-httpconnection">Esperimenti HTTPConnection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unibo-basicomm23-ws-wsconnection">unibo.basicomm23.ws.WsConnection</a><ul>
<li><a class="reference internal" href="#wsconnection-come-iobservable">WsConnection come IObservable</a></li>
<li><a class="reference internal" href="#wsconnection-il-costruttore">WsConnection il costruttore</a></li>
<li><a class="reference internal" href="#wsconnection-sendmessage">WsConnection: sendMessage</a></li>
<li><a class="reference internal" href="#wsconnection-gestione-degli-eventi">WsConnection: gestione degli eventi</a></li>
<li><a class="reference internal" href="#wsconnection-specializza-connection">WsConnection specializza Connection</a></li>
<li><a class="reference internal" href="#esperimenti-wsconnection">Esperimenti WSConnection</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#unibo-basicomm23-coap-coapconnection">unibo.basicomm23.coap.CoapConnection</a></li>
<li><a class="reference internal" href="#altri-contratti-e-supporti">Altri contratti e supporti</a><ul>
<li><a class="reference internal" href="#unibo-basicomm23-interfaces-iobserver">unibo.basicomm23.interfaces.IObserver</a></li>
<li><a class="reference internal" href="#unibo-basicomm23-interfaces-iobservable">unibo.basicomm23.interfaces.IObservable</a></li>
<li><a class="reference internal" href="#unibo-basicomm23-utilsapplabstractobserver">unibo.basicomm23.utilsApplAbstractObserver</a></li>
<li><a class="reference internal" href="#unibo-interaction-msg-applmessage">unibo.interaction.msg.ApplMessage</a></li>
<li><a class="reference internal" href="#unibo-interaction-msg-applmsghandler">unibo.interaction.msg.ApplMsgHandler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unibo-basicomm23-utils-commutils">unibo.basicomm23.utils.CommUtils</a><ul>
<li><a class="reference internal" href="#metodi-di-uso-comune">Metodi di uso comune</a></li>
<li><a class="reference internal" href="#metodi-per-la-costruzione-di-messaggi">Metodi per la costruzione di messaggi</a></li>
<li><a class="reference internal" href="#metodi-per-modificare-stringhe-messaggio">Metodi per modificare stringhe-messaggio</a></li>
</ul>
</li>
<li><a class="reference internal" href="#esempi-di-uso-di-basicomm23">Esempi di uso di basicomm23</a><ul>
<li><a class="reference internal" href="#unibo-basicomm23-examples-mainprodcons">unibo.basicomm23.examples.MainProdCons</a></li>
<li><a class="reference internal" href="#verso-gli-attori">Verso gli attori</a></li>
<li><a class="reference internal" href="#producer">Producer</a></li>
<li><a class="reference internal" href="#consumer">Consumer</a></li>
<li><a class="reference internal" href="#unibo-basicomm23-examples-pingpong">unibo.basicomm23.examples.pingpong</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="Interaction.html"
                          title="previous chapter">Interaction</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="Appl1-HTTPSprint3.html"
                          title="next chapter">Appl1-HTTPSprint3</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/unibo.basicomm23.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Appl1-HTTPSprint3.html" title="Appl1-HTTPSprint3"
             >next</a> |</li>
        <li class="right" >
          <a href="Interaction.html" title="Interaction"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">iss23 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">unibo.basicomm23</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Antonio Natali.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>